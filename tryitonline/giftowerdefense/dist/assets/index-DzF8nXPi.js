var Qr=d=>{throw TypeError(d)};var Er=(d,s,e)=>s.has(d)||Qr("Cannot "+e);var t=(d,s,e)=>(Er(d,s,"read from private field"),e?e.call(d):s.get(d)),a=(d,s,e)=>s.has(d)?Qr("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(d):s.set(d,e),i=(d,s,e,n)=>(Er(d,s,"write to private field"),n?n.call(d,e):s.set(d,e),e),h=(d,s,e)=>(Er(d,s,"access private method"),e);var D=(d,s,e,n)=>({set _(o){i(d,s,o,e)},get _(){return t(d,s,n)}});import{p as Ir,a as uc}from"./vendor-Do-rcby2.js";(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const c of o)if(c.type==="childList")for(const I of c.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&n(I)}).observe(document,{childList:!0,subtree:!0});function e(o){const c={};return o.integrity&&(c.integrity=o.integrity),o.referrerPolicy&&(c.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?c.credentials="include":o.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function n(o){if(o.ep)return;o.ep=!0;const c=e(o);fetch(o.href,c)}})();const M=class M{};M.TILE_SIZE=50,M.MAX_WAVE_ENEMIES=5,M.UPGRADE_MAX_LEVEL=5,M.CANVAS_WIDTH=800,M.CANVAS_HEIGHT=580,M.KEY_1=49,M.KEY_2=50,M.KEY_3=51,M.TOWER_OFFSET=5,M.EXPLOSION_OFFSET=25,M.GAME_STATUS_PLAYING=0,M.GAME_STATUS_GAME_OVER=1,M.WAVE_PROGRESS_DELAY=35,M.BOSS_PROGRESS_DELAY=M.WAVE_PROGRESS_DELAY*6,M.MONEY_MULTIPLICATOR=6,M.DELAY_UPGRADE_MULTIPLIER=5,M.MAGIC_STATUS_ALIVE=0,M.MAGIC_STATUS_DEAD=1,M.SCALE_MINIMAP=7;let l=M;class r{static init(s){r.p5=s}}var Ue;class ct{constructor(s){a(this,Ue);i(this,Ue,{...s})}get position(){return t(this,Ue)}set position(s){i(this,Ue,{...s})}}Ue=new WeakMap;var ps,pt,an,_i,eo,io;class Xa extends ct{constructor(e,n){super(e);a(this,_i);a(this,ps);a(this,pt,0);a(this,an);i(this,ps,{...n}),i(this,an,t(this,ps).w-1)}get progress(){return t(this,pt)}reinitProgress(){i(this,pt,0)}increaseProgress(e=1){i(this,pt,t(this,pt)+e),t(this,pt)>100&&i(this,pt,100)}isFullOfProgress(){return t(this,pt)>=100}draw(){h(this,_i,eo).call(this),t(this,pt)>0&&h(this,_i,io).call(this)}}ps=new WeakMap,pt=new WeakMap,an=new WeakMap,_i=new WeakSet,eo=function(){r.p5.strokeWeight(1),r.p5.stroke("black"),r.p5.fill("green"),r.p5.rect(this.position.x,this.position.y,t(this,ps).w,t(this,ps).h)},io=function(){r.p5.strokeWeight(0),r.p5.fill("red");const e=t(this,pt)*t(this,an)/100;r.p5.rect(this.position.x+1,this.position.y+1,e,t(this,ps).h-2)};class Hr extends ct{constructor(s){super(s),this.startPosition={...s},this.status=l.MAGIC_STATUS_ALIVE}die(){this.status=l.MAGIC_STATUS_DEAD}get alive(){return this.status==l.MAGIC_STATUS_ALIVE}}var ie,rn,on;const er=class er extends Hr{constructor(e,n,o){super(n.position);a(this,ie);a(this,rn);a(this,on);i(this,on,e),i(this,ie,n),i(this,rn,o)}freeze(e){e.freeze()}draw(){r.p5.image(t(this,on),this.position.x,this.position.y)}updatePosition(){this.position=t(this,ie).position}updateStatus(){t(this,ie).isAlive?this.status=l.MAGIC_STATUS_ALIVE:this.status=l.MAGIC_STATUS_DEAD}update(e){t(this,ie).update(),this.updatePosition(),this.updateStatus(),t(this,rn).check(this,e.getAll())}};ie=new WeakMap,rn=new WeakMap,on=new WeakMap,er.FREEZE_ENEMY_MAX_TIME=500,er.SPEED=10;let Ji=er;var Ce,hn,ne,mt,cn,Jt,ae,Be,be,Ge,Nt,ir,nr,Lt,no,wr,ao,ro;const P=class P extends ct{constructor(e,n,o,c,I,p){super(e);a(this,Lt);a(this,Ce);a(this,hn);a(this,ne);a(this,mt);a(this,cn);a(this,Jt);a(this,ae);a(this,Be,!1);a(this,be,!1);a(this,Ge,0);a(this,Nt,0);a(this,ir,50);a(this,nr,50);i(this,Ce,n),i(this,hn,o),i(this,cn,c),i(this,ne,I),i(this,mt,p),i(this,Jt,h(this,Lt,no).call(this)),i(this,ae,P.STATUS_ALIVE)}isBoss(){return t(this,hn)}get endurance(){return t(this,Ce)}get id(){return t(this,cn)}get dead(){return t(this,ae)==P.STATUS_DEAD}get alive(){return t(this,ae)==P.STATUS_ALIVE}get winner(){return t(this,Be)}get isAbducted(){return t(this,Nt)>=P.SIZE}addDamage(e){const n=e/t(this,Ce);t(this,Jt).increaseProgress(n),t(this,Jt).isFullOfProgress()&&i(this,ae,P.STATUS_DEAD)}get damage(){return t(this,Jt).progress}freeze(){i(this,be,!0)}resetWinner(){i(this,Be,!1)}dropFromUFO(){h(this,Lt,wr).call(this)}get currentDirection(){return t(this,mt).currentDirection}get orderPosition(){return t(this,mt).indexOrder}get moveCount(){return t(this,mt).moveCount}updatePosition(){this.position=t(this,mt).position}update(){if(!this.isAbducted){if(t(this,be)){t(this,Ge)<Ji.FREEZE_ENEMY_MAX_TIME?D(this,Ge)._++:(i(this,be,!1),i(this,Ge,0));return}t(this,mt).update(),t(this,mt).isAlive||h(this,Lt,ao).call(this),this.updatePosition(),t(this,ne).update(),h(this,Lt,ro).call(this)}}draw(){this.isAbducted||(r.p5.image(t(this,ne).imageToDraw,this.position.x+t(this,Nt)/2,this.position.y,t(this,ir)-t(this,Nt),t(this,nr)-t(this,Nt)),t(this,Jt).draw())}decrementSize(){t(this,Nt)<P.SIZE&&i(this,Nt,t(this,Nt)+P.REDUCTION_FACTOR)}};Ce=new WeakMap,hn=new WeakMap,ne=new WeakMap,mt=new WeakMap,cn=new WeakMap,Jt=new WeakMap,ae=new WeakMap,Be=new WeakMap,be=new WeakMap,Ge=new WeakMap,Nt=new WeakMap,ir=new WeakMap,nr=new WeakMap,Lt=new WeakSet,no=function(){const e={x:0,y:0},n={w:27,h:7};return new Xa(e,n)},wr=function(){t(this,ne).restart(),i(this,Nt,0),t(this,mt).reinit()},ao=function(){i(this,Be,!0),h(this,Lt,wr).call(this)},ro=function(){t(this,Jt).position={x:this.position.x+10,y:this.position.y+3}},P.VELOCITY=1,P.BOSS_VELOCITY=.5,P.STATUS_ALIVE=0,P.STATUS_DEAD=1,P.TOTAL_ENEMIES=5,P.CREATION_MAX_TIME=200,P.SIZE=50,P.REDUCTION_FACTOR=.6,P.waveEnemies=0,P.allowCreateEnemies=!0,P.createEnemyTime=0;let v=P;class te{static range(s,e){return Array.from({length:e-s+1},(n,o)=>o+s)}static getTwoNumbersFourTimes(s){return[s*4,(s+1)*4]}}class y{static enemies(){const s=[],e=v.TOTAL_ENEMIES+1;return te.range(1,e).forEach(n=>{s.push(r.p5.loadImage("../img/enemies/"+n+"_center.png")),s.push(r.p5.loadImage("../img/enemies/"+n+"_left.png")),s.push(r.p5.loadImage("../img/enemies/"+n+"_right.png")),s.push(r.p5.loadImage("../img/enemies/"+n+"_closed.png"))}),s}static greenTower(){const s=[];return te.range(0,l.UPGRADE_MAX_LEVEL).forEach(e=>{s.push(r.p5.loadImage("../img/towers/green_tower_upgrade_"+e+".png"))}),s}static redTower(){const s=[];return te.range(0,l.UPGRADE_MAX_LEVEL).forEach(e=>{s.push(r.p5.loadImage("../img/towers/red_tower_upgrade_"+e+".png"))}),s}static yellowTower(){const s=[];return te.range(0,l.UPGRADE_MAX_LEVEL).forEach(e=>{s.push(r.p5.loadImage("../img/towers/yellow_tower_upgrade_"+e+".png"))}),s}static tileImages(){return[r.p5.loadImage("../img/tiles/orange.png"),r.p5.loadImage("../img/tiles/black.png"),r.p5.loadImage("../img/tiles/end_down.png"),r.p5.loadImage("../img/tiles/end_right.png"),r.p5.loadImage("../img/tiles/end_left.png"),r.p5.loadImage("../img/tiles/end_up.png"),r.p5.loadImage("../img/tiles/start_down.png"),r.p5.loadImage("../img/tiles/start_right.png"),r.p5.loadImage("../img/tiles/start_left.png"),r.p5.loadImage("../img/tiles/start_up.png"),r.p5.loadImage("../img/tiles/crystal.png")]}static hudImages(){return[r.p5.loadImage("../img/hud/normal.png"),r.p5.loadImage("../img/hud/upgrading.png"),r.p5.loadImage("../img/hud/upgrading_max.png")]}static towerGreenButtonImages(){return[r.p5.loadImage("../img/hud/btn_tower_green_on.png"),r.p5.loadImage("../img/hud/btn_tower_green_off.png"),r.p5.loadImage("../img/hud/btn_tower_green_hover.png"),r.p5.loadImage("../img/hud/btn_tower_green_off_hover.png")]}static towerRedButtonImages(){return[r.p5.loadImage("../img/hud/btn_tower_red_on.png"),r.p5.loadImage("../img/hud/btn_tower_red_off.png"),r.p5.loadImage("../img/hud/btn_tower_red_hover.png"),r.p5.loadImage("../img/hud/btn_tower_red_off_hover.png")]}static towerYellowButtonImages(){return[r.p5.loadImage("../img/hud/btn_tower_yellow_on.png"),r.p5.loadImage("../img/hud/btn_tower_yellow_off.png"),r.p5.loadImage("../img/hud/btn_tower_yellow_hover.png"),r.p5.loadImage("../img/hud/btn_tower_yellow_off_hover.png")]}static magicUFOButtonImages(){return[r.p5.loadImage("../img/hud/btn_magic_ufo_on.png"),r.p5.loadImage("../img/hud/btn_magic_ufo_off.png"),r.p5.loadImage("../img/hud/btn_magic_ufo_hover.png")]}static magicFireballButtonImages(){return[r.p5.loadImage("../img/hud/btn_magic_fireball_on.png"),r.p5.loadImage("../img/hud/btn_magic_fireball_off.png"),r.p5.loadImage("../img/hud/btn_magic_fireball_hover.png")]}static magicIceballButtonImages(){return[r.p5.loadImage("../img/hud/btn_magic_iceball_on.png"),r.p5.loadImage("../img/hud/btn_magic_iceball_off.png"),r.p5.loadImage("../img/hud/btn_magic_iceball_hover.png")]}static buttonMiniMapImages(){return[r.p5.loadImage("../img/menu/btn_minimap_on.png"),r.p5.loadImage("../img/menu/btn_minimap_off.png"),r.p5.loadImage("../img/menu/btn_minimap_hover.png")]}static buttonSurvivalImages(){return[r.p5.loadImage("../img/menu/btn_survival_on.png"),r.p5.loadImage("../img/menu/btn_survival_off.png"),r.p5.loadImage("../img/menu/btn_survival_hover.png")]}static buttonTodaysImages(){return[r.p5.loadImage("../img/menu/btn_todays_on.png"),r.p5.loadImage("../img/menu/btn_todays_off.png"),r.p5.loadImage("../img/menu/btn_todays_hover.png")]}static buttonEditorImages(){return[r.p5.loadImage("../img/menu/btn_editor_on.png"),r.p5.loadImage("../img/menu/btn_editor_off.png"),r.p5.loadImage("../img/menu/btn_editor_hover.png")]}static buttonMenuMainImages(){return[r.p5.loadImage("../img/menu/btn_menu_main_on.png"),r.p5.loadImage("../img/menu/btn_menu_main_off.png"),r.p5.loadImage("../img/menu/btn_menu_main_hover.png")]}static backgroundImage(){return r.p5.loadImage("../img/backgrounds/ground.jpg")}static coreImage(){return r.p5.loadImage("../img/hud/core.png")}static magicFireball(){return r.p5.loadImage("../img/magics/fireball.png")}static magicIceball(){return r.p5.loadImage("../img/magics/iceball.png")}static magicUFO(){return[r.p5.loadImage("../img/magics/ufo.png"),r.p5.loadImage("../img/magics/ufo_ray.png")]}static menuMain(){return r.p5.loadImage("../img/menu/menu_main.png")}static menuSurvival(){return r.p5.loadImage("../img/menu/menu_survival.png")}}class u{static _loadButtons(){u.towerGreenButtonImages=y.towerGreenButtonImages(),u.towerRedButtonImages=y.towerRedButtonImages(),u.towerYellowButtonImages=y.towerYellowButtonImages(),u.magicUFOButtonImages=y.magicUFOButtonImages(),u.magicFireballButtonImages=y.magicFireballButtonImages(),u.magicIceballButtonImages=y.magicIceballButtonImages(),u.buttonMiniMapImages=y.buttonMiniMapImages(),u.buttonSurvivalImages=y.buttonSurvivalImages(),u.buttonEditorImages=y.buttonEditorImages(),u.buttonMenuMainImages=y.buttonMenuMainImages(),u.buttonTodaysImages=y.buttonTodaysImages()}static _loadMagics(){u.magicFireballImage=y.magicFireball(),u.magicIceballImage=y.magicIceball(),u.magicUFOImages=y.magicUFO()}static _loadTowers(){u.greenTowerImages=y.greenTower(),u.redTowerImages=y.redTower(),u.yellowTowerImages=y.yellowTower()}static _loadOthers(){u.enemiesImages=y.enemies(),u.tileImages=y.tileImages(),u.hudImages=y.hudImages(),u.backgroundImage=y.backgroundImage(),u.coreImage=y.coreImage()}static _loadMenu(){u.menuMain=y.menuMain(),u.menuSurvival=y.menuSurvival()}static loadAll(){u._loadMenu(),u._loadMagics(),u._loadTowers(),u._loadButtons(),u._loadOthers()}}class fr{static integerBetween(s,e){return Math.floor(Math.random()*(e-s+1))+s}}var ln,Ft,_e,ke,re,ms,oe,he,un,Mt,oo,ho,Ar,co;const L=class L{constructor(s){a(this,Mt);a(this,ln);a(this,Ft);a(this,_e);a(this,ke);a(this,re,0);a(this,ms,0);a(this,oe,0);a(this,he,0);a(this,un,0);i(this,ln,s),i(this,ke,[L.EYES_LEFT,L.EYES_CENTER,L.EYES_RIGHT,L.EYES_CENTER]),i(this,Ft,L.EYES_CENTER),i(this,_e,L.EYES_CENTER)}update(){h(this,Mt,co).call(this)}get imageToDraw(){return t(this,ln)[t(this,Ft)]}restart(){i(this,re,0),i(this,ms,0),i(this,oe,0),i(this,he,0),h(this,Mt,Ar).call(this)}};ln=new WeakMap,Ft=new WeakMap,_e=new WeakMap,ke=new WeakMap,re=new WeakMap,ms=new WeakMap,oe=new WeakMap,he=new WeakMap,un=new WeakMap,Mt=new WeakSet,oo=function(){return t(this,Ft)!=L.EYES_CLOSED},ho=function(){D(this,re)._++,t(this,re)>L.CHANGE_EYES_MAX_TIME&&(i(this,re,0),D(this,ms)._++,t(this,ms)==t(this,ke).length&&i(this,ms,0),i(this,Ft,t(this,ke)[t(this,ms)]))},Ar=function(){i(this,un,fr.integerBetween(L.MIN_TIME_TO_CLOSE,L.MAX_TIME_TO_CLOSE))},co=function(){h(this,Mt,oo).call(this)?(D(this,oe)._++,t(this,oe)>t(this,un)&&(i(this,oe,0),h(this,Mt,Ar).call(this),i(this,_e,t(this,Ft)),i(this,Ft,L.EYES_CLOSED)),h(this,Mt,ho).call(this)):(D(this,he)._++,t(this,he)>L.EXTEND_CLOSED_EYES_MAX_TIME&&(i(this,he,0),i(this,Ft,t(this,_e))))},L.CHANGE_EYES_MAX_TIME=50,L.EXTEND_CLOSED_EYES_MAX_TIME=20,L.MIN_TIME_TO_CLOSE=50,L.MAX_TIME_TO_CLOSE=200,L.EYES_CENTER=0,L.EYES_LEFT=1,L.EYES_RIGHT=2,L.EYES_CLOSED=3,L.INDEX_BOSS_IN_ENEMIES_IMAGES=5;let Fe=L;var Ts;class gc{constructor(s){a(this,Ts);i(this,Ts,s)}createNormal(s,e,n,o,c){const I=n*3+s*2,p=!1,V=t(this,Ts).generateId();t(this,Ts).add(new v(e,I,p,V,o,c))}createBoss(s,e,n,o){const c=e*25,I=!0,p=t(this,Ts).generateId();t(this,Ts).add(new v(s,c,I,p,n,o))}}Ts=new WeakMap;class lo extends ct{constructor(s){super(s)}}const Re=class Re{};Re.LEFT=1,Re.RIGHT=2,Re.UP=3,Re.DOWN=4;let E=Re;var Ye,ws,gn,at,B,x,Tt,m,Hi,Or,yr,Sr,Lr,zi,uo,go,Eo,Io,po;const qi=class qi{constructor(s,e,n){a(this,m);a(this,Ye);a(this,ws);a(this,gn);a(this,at,[]);a(this,B);a(this,x);a(this,Tt,!1);i(this,Ye,s),i(this,ws,e),i(this,gn,n);const o=t(this,Ye).position;i(this,B,new lo({x:o.x,y:o.y})),i(this,x,t(this,Ye).getStartDirection())}get endReached(){return t(this,Tt)}getTilePath(s,e){const n=t(this,gn).find(o=>s===o.position.x&&e===o.position.y);return n||null}getTileEnd(s,e){return t(this,ws).position.x===s&&t(this,ws).position.y===e?t(this,ws):null}makeOrders(){t(this,at).push(t(this,x));let s=0;for(;s<qi.MAX_SEARCHES&&!t(this,Tt);)s++,h(this,m,po).call(this);return t(this,Tt)&&t(this,at).push(t(this,x)),t(this,at)}};Ye=new WeakMap,ws=new WeakMap,gn=new WeakMap,at=new WeakMap,B=new WeakMap,x=new WeakMap,Tt=new WeakMap,m=new WeakSet,Hi=function(s){const e=this.getTilePath(s.x,s.y);return e===null?this.getTileEnd(s.x,s.y):e},Or=function(s){const e=s.position.x-l.TILE_SIZE,n=s.position.y,o={x:e,y:n};return h(this,m,Hi).call(this,o)},yr=function(s){const e=s.position.x,n=s.position.y+l.TILE_SIZE,o={x:e,y:n};return h(this,m,Hi).call(this,o)},Sr=function(s){const e=s.position.x+l.TILE_SIZE,n=s.position.y,o={x:e,y:n};return h(this,m,Hi).call(this,o)},Lr=function(s){const e=s.position.x,n=s.position.y-l.TILE_SIZE,o={x:e,y:n};return h(this,m,Hi).call(this,o)},zi=function(){const s=t(this,B).position.x,e=t(this,B).position.y,n=t(this,ws).position,o=n.x,c=n.y;s===o&&e===c&&i(this,Tt,!0)},uo=function(){if(h(this,m,zi).call(this),t(this,Tt))t(this,at).push(t(this,x));else{const s=h(this,m,Or).call(this,t(this,B));s!==null?(t(this,at).push(E.LEFT),i(this,B,s)):h(this,m,yr).call(this,t(this,B))?i(this,x,E.DOWN):i(this,x,E.UP)}},go=function(){if(h(this,m,zi).call(this),t(this,Tt))t(this,at).push(t(this,x));else{const s=h(this,m,yr).call(this,t(this,B));s!==null?(t(this,at).push(E.DOWN),i(this,B,s)):h(this,m,Sr).call(this,t(this,B))?i(this,x,E.RIGHT):i(this,x,E.LEFT)}},Eo=function(){if(h(this,m,zi).call(this),t(this,Tt))t(this,at).push(t(this,x));else{const s=h(this,m,Sr).call(this,t(this,B));s!==null?(t(this,at).push(E.RIGHT),i(this,B,s)):h(this,m,Lr).call(this,t(this,B))?i(this,x,E.UP):i(this,x,E.DOWN)}},Io=function(){if(h(this,m,zi).call(this),t(this,Tt))t(this,at).push(t(this,x));else{const s=h(this,m,Lr).call(this,t(this,B));s!==null?(t(this,at).push(E.UP),i(this,B,s)):h(this,m,Or).call(this,t(this,B))?i(this,x,E.LEFT):i(this,x,E.RIGHT)}},po=function(){t(this,x)===E.LEFT&&h(this,m,uo).call(this),t(this,x)===E.DOWN&&h(this,m,go).call(this),t(this,x)===E.RIGHT&&h(this,m,Eo).call(this),t(this,x)===E.UP&&h(this,m,Io).call(this)},qi.MAX_SEARCHES=1e3,qi.orders=[];let se=qi;var rt,fs,As,wt,Qt,vt,ce,dn,_t,mo,To,wo,fo;class zr{constructor(s,e,n){a(this,_t);a(this,rt);a(this,fs);a(this,As);a(this,wt,0);a(this,Qt);a(this,vt,0);a(this,ce);a(this,dn);i(this,dn,{...s}),i(this,rt,{...s}),i(this,fs,e),i(this,As,t(this,fs)[t(this,wt)]),i(this,Qt,n),i(this,ce,!0)}get position(){return t(this,rt)}update(){h(this,_t,mo).call(this),h(this,_t,To).call(this),h(this,_t,wo).call(this)}get nextOrderDirection(){return D(this,wt)._++,t(this,fs)[t(this,wt)]}get indexOrder(){return t(this,wt)}get endReached(){return t(this,wt)==t(this,fs).length}get isAlive(){return t(this,ce)}get moveCount(){return t(this,vt)}get currentDirection(){return t(this,As)}set moveCount(s){i(this,vt,s)}reinit(){i(this,vt,0),i(this,wt,0),i(this,As,t(this,fs)[t(this,wt)]),i(this,rt,{...t(this,dn)}),i(this,ce,!0)}}rt=new WeakMap,fs=new WeakMap,As=new WeakMap,wt=new WeakMap,Qt=new WeakMap,vt=new WeakMap,ce=new WeakMap,dn=new WeakMap,_t=new WeakSet,mo=function(){switch(t(this,As)){case E.LEFT:t(this,rt).x=t(this,rt).x-t(this,Qt);break;case E.RIGHT:t(this,rt).x=t(this,rt).x+t(this,Qt);break;case E.UP:t(this,rt).y=t(this,rt).y-t(this,Qt);break;case E.DOWN:t(this,rt).y=t(this,rt).y+t(this,Qt);break}},To=function(){i(this,vt,t(this,vt)+t(this,Qt))},wo=function(){t(this,vt)===l.TILE_SIZE&&(i(this,vt,0),this.endReached?h(this,_t,fo).call(this):i(this,As,this.nextOrderDirection))},fo=function(){D(this,wt)._++,i(this,ce,!1)};var Os,Xe,le,En;const Yt=class Yt{constructor(){a(this,Xe,7);a(this,le,0);a(this,En,1);if(t(Yt,Os)!==null)throw new Error("Player is a singleton class. Use getInstance to get the instance of the Player");i(Yt,Os,this)}static getInstance(){return t(Yt,Os)===null&&i(Yt,Os,new Yt),t(Yt,Os)}get lives(){return t(this,Xe)}get wave(){return t(this,En)}get score(){return t(this,le)}set score(s){i(this,le,s)}increaseWave(){D(this,En)._++}increaseScore(s){i(this,le,t(this,le)+s)}getPrintScore(){return String(t(this,le)).padStart(10,"0")}increaseLives(s){i(this,Xe,t(this,Xe)+s)}decreaseLives(){D(this,Xe)._--}};Os=new WeakMap,Xe=new WeakMap,le=new WeakMap,En=new WeakMap,a(Yt,Os,null);let Ha=Yt;class Ao{constructor(){this.instances=[]}getAll(){return this.instances}removeDeadInstances(){this.instances=this.instances.filter(s=>s.alive)}drawInstances(){this.instances.forEach(s=>{s.draw()})}}var In;class pr extends Ao{constructor(e){super();a(this,In);i(this,In,e)}add(e){this.instances.push(e)}updateInstances(){this.instances.forEach(e=>{e.update(t(this,In))})}}In=new WeakMap;var pn;class dc extends Ao{constructor(){super(...arguments);a(this,pn,0)}add(e){this.instances.push(e)}generateId(){return D(this,pn)._++,t(this,pn)}updateInstances(){this.instances.forEach(e=>{e.update()})}}pn=new WeakMap;const De=class De{};De.GRAY=[50,50,50],De.GREEN=[75,185,35],De.YELLOW=[202,191,24],De.RED=[185,35,35];let J=De;class Le{static distance(s,e){return Math.sqrt((s.x-e.x)*(s.x-e.x)+(s.y-e.y)*(s.y-e.y))}static isInsideRectangle(s,e,n){let o=!1,c=!1;return s.x>=e.x&&s.x<=e.x+n.w&&(o=!0),s.y>=e.y&&s.y<=e.y+n.h&&(c=!0),!!(o&&c)}}var xe,Oo,Mr;const ds=class ds extends ct{constructor(e,n){super(e);a(this,xe);this.upgrading=!1,this.upgradeLevel=0,this.upgradeProgress=0,this.delayUpgradeProgress=0,this.enemyTarget=null,this.distanceToEnemyTarget=0,this.progressBar=h(this,xe,Oo).call(this),this.tileOrange=n}upgrade(){this.upgrading=!0,this.upgradeLevel++}get notUpgrading(){return!this.upgrading}get sellProfit(){return 0}get isMaxUpgraded(){return this.upgradeLevel===l.UPGRADE_MAX_LEVEL}getCostWhenUpgradeLevelIs(e){return 0}get cost(){return this.getCostWhenUpgradeLevelIs(this.upgradeLevel)}get nextLevelUpgradeCost(){return this.isMaxUpgraded?this.getCostWhenUpgradeLevelIs(l.UPGRADE_MAX_LEVEL-1):this.getCostWhenUpgradeLevelIs(this.upgradeLevel+1)}isDistanceIntoInfluenceArea(e){return null}selectTarget(e){let n=99999,o=null;e.forEach(c=>{if(!c.isAbducted){const I=Le.distance({x:this.position.x,y:this.position.y},{x:c.position.x,y:c.position.y});I<n&&(n=I,o=c)}}),this.isDistanceIntoInfluenceArea(n)?(this.enemyTarget=o,this.distanceToEnemyTarget=n):(this.enemyTarget=null,this.distanceToEnemyTarget=0)}get upgradeIncrement(){return ds.UPGRADE_INCREMENT/(this.upgradeLevel+1)}update(){this.upgrading&&(ds.INSTANT_UPGRADING?h(this,xe,Mr).call(this):this.progressBar.isFullOfProgress()?h(this,xe,Mr).call(this):this.progressBar.increaseProgress(this.upgradeIncrement))}get type(){return 0}_drawUpgradeBackground(e,n){r.p5.strokeWeight(1),r.p5.stroke("black"),r.p5.fill(e),r.p5.rect(this.position.x+n,this.position.y+n,l.TILE_SIZE,l.TILE_SIZE)}};xe=new WeakSet,Oo=function(){const e={x:this.position.x+l.TOWER_OFFSET+10,y:this.position.y+l.TOWER_OFFSET+20},n={w:27,h:7};return new Xa(e,n)},Mr=function(){this.upgrading=!1,this.progressBar.reinitProgress()},ds.OFFSET_X=3,ds.OFFSET_Y=4,ds.UPGRADE_INCREMENT=1,ds.INSTANT_UPGRADING=!1;let yt=ds;var We,kt,yo,So,Lo,Mo;const Z=class Z extends yt{constructor(e,n,o){super(e,n);a(this,kt);a(this,We);i(this,We,o)}draw(){this.upgrading?h(this,kt,So).call(this):this.enemyTarget?h(this,kt,Lo).call(this):h(this,kt,Mo).call(this)}get influenceArea(){return Z.UPGRADE_INFLUENCE_AREA[this.upgradeLevel]}getCostWhenUpgradeLevelIs(e){return e>l.UPGRADE_MAX_LEVEL?Z.COST_UPGRADE[l.UPGRADE_MAX_LEVEL]:Z.COST_UPGRADE[e]}get sellProfit(){return Z.PROFIT_SELL_UPGRADE[this.upgradeLevel]}get type(){return Z.ID}isDistanceIntoInfluenceArea(e){return e<=Z.UPGRADE_INFLUENCE_AREA[this.upgradeLevel]/Z.INFLUENCE_AREA_FACTOR}};We=new WeakMap,kt=new WeakSet,yo=function(){r.p5.strokeWeight(3),r.p5.stroke(J.RED),r.p5.line(-1,-18,7-this.distanceToEnemyTarget/7,-this.distanceToEnemyTarget)},So=function(){this._drawUpgradeBackground(J.GREEN,4),this.progressBar.isFullOfProgress()||this.progressBar.draw()},Lo=function(){if(!this.enemyTarget)return;let e=this.enemyTarget.position.x-this.position.x,n=this.enemyTarget.position.y-this.position.y,o=Math.atan2(n,e)+1.55,c=r.p5.cos(o),I=r.p5.sin(o);r.p5.imageMode(r.p5.CENTER),r.p5.applyMatrix(c,I,-I,c,this.position.x+30,this.position.y+30),h(this,kt,yo).call(this),this.enemyTarget.addDamage(Z.DAMAGE_UPGRADE[this.upgradeLevel]),r.p5.image(t(this,We)[this.upgradeLevel],0,0),r.p5.resetMatrix(),r.p5.imageMode(r.p5.CORNER)},Mo=function(){r.p5.image(t(this,We)[this.upgradeLevel],this.position.x+yt.OFFSET_X,this.position.y+yt.OFFSET_Y)},Z.ID=1,Z.PROFIT_SELL_UPGRADE=[30,35,65,220,900,1880],Z.DAMAGE_UPGRADE=[1,2,4,6,12,24],Z.COST_UPGRADE=[50,75,125,300,1e3,2e3],Z.UPGRADE_INFLUENCE_AREA=[150,180,220,300,400,550],Z.INFLUENCE_AREA_FACTOR=1.65;let Q=Z;var it,Ve,mn,ar,xo;const R=class R extends ct{constructor(e,n,o){super(e);a(this,ar);a(this,it,null);a(this,Ve,0);a(this,mn,0);i(this,it,n),i(this,mn,o)}setTarget(e){i(this,it,e)}_moveToTarget(){t(this,it)&&(this.position.x<t(this,it).position.x+l.TILE_SIZE/2?this.position.x+=R.VELOCITY:this.position.x-=R.VELOCITY,this.position.y<t(this,it).position.y+l.TILE_SIZE/2?this.position.y+=R.VELOCITY:this.position.y-=R.VELOCITY)}update(){t(this,it)?(this._moveToTarget(),h(this,ar,xo).call(this)&&(i(this,Ve,R.STATUS_DEAD),t(this,it).addDamage(t(this,mn)))):i(this,Ve,R.STATUS_DEAD)}static updateInstances(){R.instances.forEach(e=>{e.update()})}static drawInstances(){R.instances.forEach(e=>{e.draw()})}static removeDeadInstances(){R.instances=R.instances.filter(e=>e.alive)}get alive(){return t(this,Ve)==R.STATUS_ALIVE}draw(){r.p5.noStroke(),r.p5.fill(...J.RED),r.p5.circle(this.position.x,this.position.y,R.OUTER_DIAMETER),r.p5.fill(...J.YELLOW),r.p5.circle(this.position.x,this.position.y,R.INNER_DIAMETER)}};it=new WeakMap,Ve=new WeakMap,mn=new WeakMap,ar=new WeakSet,xo=function(){if(!t(this,it))return;let e=!1,n=!1;return this.position.x>t(this,it).position.x&&this.position.x<t(this,it).position.x+l.TILE_SIZE&&(e=!0),this.position.y>t(this,it).position.y&&this.position.y<t(this,it).position.y+l.TILE_SIZE&&(n=!0),e&&n},R.OUTER_DIAMETER=11,R.INNER_DIAMETER=6,R.VELOCITY=1.5,R.STATUS_ALIVE=0,R.STATUS_DEAD=1,R.instances=[];let ye=R;var Ze,He,Ks,Ro,Do,Po;const C=class C extends yt{constructor(e,n,o){super(e,n);a(this,Ks);a(this,Ze);a(this,He,0);i(this,Ze,o)}draw(){this.upgrading?h(this,Ks,Ro).call(this):this.enemyTarget?h(this,Ks,Do).call(this):h(this,Ks,Po).call(this)}get influenceArea(){return C.UPGRADE_INFLUENCE_AREA[this.upgradeLevel]}getCostWhenUpgradeLevelIs(e){return e>l.UPGRADE_MAX_LEVEL?C.COST_UPGRADE[l.UPGRADE_MAX_LEVEL]:C.COST_UPGRADE[e]}get sellProfit(){return C.PROFIT_SELL_UPGRADE[this.upgradeLevel]}get type(){return C.ID}isDistanceIntoInfluenceArea(e){return e<=C.UPGRADE_INFLUENCE_AREA[this.upgradeLevel]/C.INFLUENCE_AREA_FACTOR}};Ze=new WeakMap,He=new WeakMap,Ks=new WeakSet,Ro=function(){this._drawUpgradeBackground(J.RED,4),this.progressBar.isFullOfProgress()||this.progressBar.draw()},Do=function(){if(!this.enemyTarget)return;let e=this.enemyTarget.position.x-this.position.x,n=this.enemyTarget.position.y-this.position.y,o=Math.atan2(n,e)+1.55,c=r.p5.cos(o),I=r.p5.sin(o);r.p5.imageMode(r.p5.CENTER),r.p5.applyMatrix(c,I,-I,c,this.position.x+30,this.position.y+30),t(this,He)<C.MAXTIME_TO_RECHARGE?D(this,He)._++:(i(this,He,0),ye.instances.push(new ye({x:this.position.x+l.TILE_SIZE/2,y:this.position.y+l.TILE_SIZE/2},this.enemyTarget,C.DAMAGE_UPGRADE[this.upgradeLevel]))),r.p5.image(t(this,Ze)[this.upgradeLevel],0,0),r.p5.resetMatrix(),r.p5.imageMode(r.p5.CORNER)},Po=function(){r.p5.image(t(this,Ze)[this.upgradeLevel],this.position.x+yt.OFFSET_X,this.position.y+yt.OFFSET_Y)},C.ID=2,C.PROFIT_SELL_UPGRADE=[80,110,190,420,1200,2880],C.DAMAGE_UPGRADE=[100,140,190,250,320,450],C.COST_UPGRADE=[100,150,250,500,1300,3e3],C.UPGRADE_INFLUENCE_AREA=[150,180,220,300,400,550],C.INFLUENCE_AREA_FACTOR=1.65,C.MAXTIME_TO_RECHARGE=50;let tt=C;var ft,ys,ue,Tn,ge,ts,ze,At,wn,rr,No;const xt=class xt extends ct{constructor(e,n,o){const c=e.copy();super({x:c.x,y:c.y});a(this,rr);a(this,ft);a(this,ys);a(this,ue);a(this,Tn);a(this,ge);a(this,ts,255);a(this,ze,!1);a(this,At,null);a(this,wn,0);i(this,ft,c),i(this,ys,n),i(this,ue,o),i(this,Tn,o),i(this,ge,new Ir.Vector(fr.integerBetween(-3,3),fr.integerBetween(-3,0)))}run(){this.update(),this.display()}update(){if(this.position={x:t(this,ft).x,y:t(this,ft).y},!t(this,ze))t(this,ft).add(t(this,ge)),i(this,ts,t(this,ts)-2);else{if(!t(this,At))return;const e=t(this,At).tileOrange.getTower();if(!e||e.upgrading){h(this,rr,No).call(this);return}t(this,wn)<xt.CAPTURED_MAX_TIME?D(this,wn)._++:t(this,ys)>0?i(this,ys,t(this,ys)-xt.CAPTURED_REDUCE_FACTOR):(t(this,At).increaseCoreProgress(xt.INCREMENT_YELLOW_TOWER_PROGRESS),i(this,ts,0));let n,o;const c=t(this,At).position.x+l.TILE_SIZE/2,I=t(this,At).position.y+l.TILE_SIZE/2;this.position.y<=I?o=(I-this.position.y)/300:o=-(this.position.y-I)/300,this.position.x<=c+l.TILE_SIZE/2?n=(c-this.position.x)/300:n=-(this.position.x-c)/300;const p=new Ir.Vector(n,o,0);t(this,ft).add(t(this,ge)),t(this,ge).add(p);const V=new Ir.Vector(-n*3,-o*3,0);t(this,ft).sub(V)}}display(){r.p5.stroke(...t(this,ue),t(this,ts)),r.p5.strokeWeight(2),r.p5.fill(127,t(this,ts)),r.p5.ellipse(t(this,ft).x,t(this,ft).y,t(this,ys),t(this,ys))}get dead(){return t(this,ts)<=0}set towerYellowTarget(e){i(this,At,e),i(this,ue,xt.COLOR_CAPTURED),i(this,ze,!0),i(this,ts,255)}get towerYellowTarget(){return t(this,At)}};ft=new WeakMap,ys=new WeakMap,ue=new WeakMap,Tn=new WeakMap,ge=new WeakMap,ts=new WeakMap,ze=new WeakMap,At=new WeakMap,wn=new WeakMap,rr=new WeakSet,No=function(){i(this,ze,!1),i(this,ue,t(this,Tn)),i(this,At,null)},xt.COLOR_CAPTURED=[12,222,42],xt.CAPTURED_MAX_TIME=300,xt.CAPTURED_REDUCE_FACTOR=.25,xt.INCREMENT_YELLOW_TOWER_PROGRESS=10;let xr=xt;var fn,An,On,ss;class $r{constructor(s,e,n){a(this,fn);a(this,An);a(this,On);a(this,ss,[]);i(this,fn,s.copy()),i(this,An,e),i(this,On,n)}get particles(){return t(this,ss)}get anyAlive(){return t(this,ss).length>0}addParticle(){t(this,ss).push(new xr(t(this,fn),t(this,An),t(this,On)))}run(){for(let s=t(this,ss).length-1;s>=0;s--){let e=t(this,ss)[s];e.run(),e.dead&&t(this,ss).splice(s,1)}}}fn=new WeakMap,An=new WeakMap,On=new WeakMap,ss=new WeakMap;var yn;const or=class or extends ct{constructor(e){super(e);a(this,yn,0);this.particleSystem=null}alive(){var e;return(e=this.particleSystem)==null?void 0:e.anyAlive}update(){this.particleSystem&&this.alive&&(t(this,yn)<or.MAX_EMIT_TIME&&(D(this,yn)._++,this.particleSystem.addParticle()),this.particleSystem.run())}};yn=new WeakMap,or.MAX_EMIT_TIME=5;let Qi=or;const gt=class gt extends Qi{constructor(s){super(s),this.particleSystem=new $r(r.p5.createVector(this.position.x+l.EXPLOSION_OFFSET,this.position.y+l.EXPLOSION_OFFSET),gt.SIZE,gt.COLOR)}static instantiate(s){gt.instances.push(new gt(s))}static updateInstances(){gt.instances.forEach(s=>{s.update()})}static removeDeadInstances(){gt.instances=gt.instances.filter(s=>s.alive)}};gt.SIZE=12,gt.COLOR=[255,165,0],gt.instances=[];let ve=gt;class zs{static setForBigCenteredTitle(){r.p5.fill("white"),r.p5.stroke("black"),r.p5.strokeWeight(2),r.p5.textSize(30),r.p5.textAlign(r.p5.CENTER)}static setForHudData(){r.p5.textSize(12),r.p5.fill("white"),r.p5.stroke("black"),r.p5.strokeWeight(2),r.p5.textAlign(r.p5.LEFT)}static setForBuyingFlyIndicator(){r.p5.textSize(12),r.p5.fill(255,94,94),r.p5.stroke("black"),r.p5.strokeWeight(2),r.p5.textAlign(r.p5.LEFT)}static setForSellingFlyIndicator(){r.p5.textSize(12),r.p5.fill(86,255,98),r.p5.stroke("black"),r.p5.strokeWeight(2),r.p5.textAlign(r.p5.LEFT)}}var Sn,Ln,$e,Ke,hr,Fo;const G=class G extends ct{constructor(e,n,o){super(e);a(this,hr);a(this,Sn,!0);a(this,Ln,0);a(this,$e,"");a(this,Ke);i(this,$e,n),i(this,Ke,o)}static instantiateFlyIndicator(e,n,o){G.instances.push(new G(e,n,o))}get alive(){return t(this,Sn)}draw(){h(this,hr,Fo).call(this),t(this,Ke)&&r.p5.image(t(this,Ke),this.position.x+G.OFFSET_POS_X_ICON,this.position.y+G.OFFSET_POS_Y_ICON),r.p5.text(t(this,$e),this.position.x,this.position.y)}static drawInstances(){G.instances.forEach(e=>{e.draw()})}update(){if(D(this,Ln)._++,t(this,Ln)>G.MAX_TIME_ALIVE)i(this,Sn,!1);else{const e=this.position.y-G.MOVE_INCREMENT;this.position={x:this.position.x,y:e}}}static removeDeadInstances(){G.instances=G.instances.filter(e=>e.alive)}static updateInstances(){G.instances.forEach(e=>{e.update()})}};Sn=new WeakMap,Ln=new WeakMap,$e=new WeakMap,Ke=new WeakMap,hr=new WeakSet,Fo=function(){t(this,$e).charAt(0)=="-"?zs.setForBuyingFlyIndicator():zs.setForSellingFlyIndicator()},G.MAX_TIME_ALIVE=100,G.MOVE_INCREMENT=.5,G.OFFSET_POS_X_ICON=22,G.OFFSET_POS_Y_ICON=-10,G.instances=[];let gs=G;var Mn,Ut,xn,ki,vo,Uo;const nt=class nt extends yt{constructor(e,n,o,c){super(e,n);a(this,ki);a(this,Mn);a(this,Ut);a(this,xn);i(this,Ut,h(this,ki,vo).call(this)),i(this,xn,o),i(this,Mn,c)}upgrade(){this.upgrading||(this.upgrading=!0,this.upgradeLevel++,t(this,Ut).reinitProgress())}increaseCoreProgress(e){if(!t(this,Ut).isFullOfProgress())t(this,Ut).increaseProgress(e);else{const n=this.upgradeLevel+1;t(this,xn).increaseLives(n),t(this,Ut).reinitProgress();const o=`+ ${n}`;gs.instantiateFlyIndicator(this.position,o,u.coreImage)}}get coreProgressBarValue(){return t(this,Ut).progress}draw(){this.upgrading?h(this,ki,Uo).call(this):(t(this,Ut).draw(),r.p5.image(t(this,Mn)[this.upgradeLevel],this.position.x+yt.OFFSET_X,this.position.y+yt.OFFSET_Y))}get influenceArea(){return nt.UPGRADE_INFLUENCE_AREA[this.upgradeLevel]}getCostWhenUpgradeLevelIs(e){return e>l.UPGRADE_MAX_LEVEL?nt.COST_UPGRADE[l.UPGRADE_MAX_LEVEL]:nt.COST_UPGRADE[e]}get sellProfit(){return nt.PROFIT_SELL_UPGRADE[this.upgradeLevel]}get type(){return nt.ID}isDistanceIntoInfluenceArea(e){return e<=nt.UPGRADE_INFLUENCE_AREA[this.upgradeLevel]/nt.INFLUENCE_AREA_FACTOR}selectAllExplosionsTargets(){this.upgrading||ve.instances.forEach(e=>{e.particleSystem&&e.particleSystem.particles.forEach(o=>{if(!o.towerYellowTarget){const c=Le.distance({x:this.position.x+l.TILE_SIZE/2,y:this.position.y+l.TILE_SIZE/2},o.position);this.isDistanceIntoInfluenceArea(c)&&(o.towerYellowTarget=this)}})})}};Mn=new WeakMap,Ut=new WeakMap,xn=new WeakMap,ki=new WeakSet,vo=function(){const e={x:this.position.x+10,y:this.position.y+13},n={w:l.TILE_SIZE-13,h:l.TILE_SIZE-10};return new Xa(e,n)},Uo=function(){this._drawUpgradeBackground(J.YELLOW,5),this.progressBar.isFullOfProgress()||this.progressBar.draw()},nt.ID=3,nt.PROFIT_SELL_UPGRADE=[680,2460,7440,21920,66900,199880],nt.COST_UPGRADE=[700,2500,7500,22e3,67e3,2e5],nt.UPGRADE_INFLUENCE_AREA=[150,180,220,300,400,550],nt.INFLUENCE_AREA_FACTOR=2;let st=nt;var es,qe,Ss;const H=class H{constructor(s,e){a(this,qe,0);a(this,Ss,0);if(t(H,es)!==null)throw new Error("Wallet is a singleton class, use getInstance to get the instance");i(this,qe,s),this.initialMoney=e,i(H,es,this)}static getInstance(s,e){return t(H,es)===null&&i(H,es,new H(s,e)),t(H,es)}static clearInstance(){i(H,es,null)}isGameInTestingMode(){return t(this,qe)===H.GAME_TESTING_MODE}set initialMoney(s){if(s<0)throw new Error("Money must be a positive number");i(this,Ss,s),t(this,qe)===H.GAME_TESTING_MODE&&i(this,Ss,H.MONEY_IN_TESTING_MODE)}get money(){return t(this,Ss)}decreaseMoney(s){i(this,Ss,t(this,Ss)-s)}increaseMoney(s){i(this,Ss,t(this,Ss)+s)}haveMoneyToUpgradeTower(s,e){let n=!1;switch(s){case Q.ID:n=this.money>=Q.COST_UPGRADE[e];break;case tt.ID:n=this.money>=tt.COST_UPGRADE[e];break;case st.ID:n=this.money>=st.COST_UPGRADE[e];break}return n}haveMoneyToBuyNewTower(s){return this.haveMoneyToUpgradeTower(s,0)}sellTower(s){if(s.upgrading)return;const e=s.sellProfit;this.increaseMoney(e);const n=`+${e} $`;gs.instantiateFlyIndicator(s.position,n),s.tileOrange.removeTower()}upgradeTower(s){if(s.isMaxUpgraded||!this.haveMoneyToUpgradeTower(s.type,s.upgradeLevel+1)||s.upgrading)return;s.upgrade();const e=s.cost;this.decreaseMoney(e);const n=`-${e} $`;gs.instantiateFlyIndicator(s.position,n)}buyTower(s,e){if(!this.haveMoneyToBuyNewTower(e))return;s.instantiateNewTower(e);const n=s.getTower();if(!n)return;const o=n.cost;this.decreaseMoney(o);const c=`-${o} $`;gs.instantiateFlyIndicator(n.position,c)}};es=new WeakMap,qe=new WeakMap,Ss=new WeakMap,a(H,es,null),H.GAME_NORMAL_MODE=0,H.GAME_TESTING_MODE=1,H.MONEY_IN_TESTING_MODE=999999;let za=H;var de;const N=class N{constructor(s){a(this,de);i(this,de,s)}draw(){switch(N.mode){case N.NORMAL:r.p5.image(t(this,de)[N.NORMAL],0,0);break;case N.UPGRADING:r.p5.image(t(this,de)[N.UPGRADING],0,0);break;case N.UPGRADING_MAX:r.p5.image(t(this,de)[N.UPGRADING_MAX],0,0);break}}selectHudMode(s){s&&(s.isMaxUpgraded?N.mode=N.UPGRADING_MAX:N.mode=N.UPGRADING)}drawNormalHud(){N.mode=N.NORMAL}};de=new WeakMap,N.NORMAL=0,N.UPGRADING=1,N.UPGRADING_MAX=2,N.HEIGHT=84,N.mode=0;let q=N;const Es=class Es extends ct{constructor(s,e,n,o={x:0,y:0}){super(s),this.size={...e},this.images=n,this.offsetImages={...o}}draw(){this.isMouseOver({x:r.p5.mouseX,y:r.p5.mouseY})?this.drawHover():this.drawOn()}drawOn(){r.p5.image(this.images[Es.INDEX_IMAGE_ON],this.position.x+this.offsetImages.x,this.position.y+this.offsetImages.y)}drawOff(){r.p5.image(this.images[Es.INDEX_IMAGE_OFF],this.position.x+this.offsetImages.x,this.position.y+this.offsetImages.y)}drawHover(){r.p5.image(this.images[Es.INDEX_IMAGE_HOVER],this.position.x+this.offsetImages.x,this.position.y+this.offsetImages.y)}isMouseOver(s){return Le.isInsideRectangle(s,this.position,this.size)}};Es.INDEX_IMAGE_ON=0,Es.INDEX_IMAGE_OFF=1,Es.INDEX_IMAGE_HOVER=2;let $s=Es;var Ls,Rn,Yi,Co,Bo;const A=class A extends $s{constructor(){super(...arguments);a(this,Yi);a(this,Ls,!1);a(this,Rn,!1)}check(){i(this,Ls,!0)}uncheck(){i(this,Ls,!1)}get isChecked(){return t(this,Ls)}drawCheckRectangle(){r.p5.strokeWeight(3),r.p5.stroke(255,204,0),r.p5.noFill(),r.p5.square(this.position.x+this.offsetImages.x-2,this.position.y+this.offsetImages.y-2,36)}drawOffHover(){r.p5.image(this.images[A.INDEX_IMAGE_OFF_HOVER],this.position.x+this.offsetImages.x,this.position.y+this.offsetImages.y)}set on(e){i(this,Rn,e)}get isMouseInsideAndNotChecked(){return this.isMouseOver({x:r.p5.mouseX,y:r.p5.mouseY})&&!t(this,Ls)}draw(){t(this,Rn)?h(this,Yi,Co).call(this):h(this,Yi,Bo).call(this),t(this,Ls)&&this.drawCheckRectangle()}static setImages(e,n,o){A.towerGreenButtonImages=e,A.towerRedButtonImages=n,A.towerYellowButtonImages=o}static _initializeGreenTowerButton(){const e={x:0,y:28},n={w:98,h:50},o={x:60,y:10};A.greenTowerButton=new A(e,n,A.towerGreenButtonImages,o)}static _initializeRedTowerButton(){const e={x:98,y:28},n={w:82,h:50},o={x:45,y:10};A.redTowerButton=new A(e,n,A.towerRedButtonImages,o)}static _initializeYellowTowerButton(){const e={x:180,y:28},n={w:83,h:50},o={x:47,y:10};A.yellowTowerButton=new A(e,n,A.towerYellowButtonImages,o)}static initializeButtons(){A._initializeTowerButtons()}static uncheckAllTowerButtons(){A.greenTowerButton.uncheck(),A.redTowerButton.uncheck(),A.yellowTowerButton.uncheck()}static _initializeTowerButtons(){A._initializeGreenTowerButton(),A._initializeRedTowerButton(),A._initializeYellowTowerButton(),A.uncheckAllTowerButtons(),A.greenTowerButton.check()}};Ls=new WeakMap,Rn=new WeakMap,Yi=new WeakSet,Co=function(){this.isMouseInsideAndNotChecked?this.drawHover():this.drawOn()},Bo=function(){this.isMouseInsideAndNotChecked?this.drawOffHover():this.drawOff()},A.INDEX_IMAGE_OFF_HOVER=3;let U=A;var je,Je,Qe,Ee,Ms,xs,ti,O,bo,Go,_o,ko,Yo,Xo,Wo,$i,Vo,Zo;const Is=class Is{constructor(s){a(this,O);a(this,je,!1);a(this,Je,!1);a(this,Qe,!1);a(this,Ee);a(this,Ms,null);a(this,xs,null);a(this,ti);i(this,Ee,s),i(this,ti,!1)}isInsideTowersButtonsBar(s){return!!(h(this,O,bo).call(this,s)&&s.x<265)}selectTower(s){switch(U.uncheckAllTowerButtons(),s){case Q.ID:U.greenTowerButton.check();break;case tt.ID:U.redTowerButton.check();break;case st.ID:U.yellowTowerButton.check();break}}getSelectedTower(){return U.greenTowerButton.isChecked?Q.ID:U.redTowerButton.isChecked?tt.ID:st.ID}draw(){q.mode===q.NORMAL&&(h(this,O,Zo).call(this),h(this,O,Go).call(this)),zs.setForHudData(),q.mode!=q.UPGRADING_MAX&&h(this,O,_o).call(this),h(this,O,ko).call(this),q.mode===q.NORMAL&&h(this,O,Vo).call(this)}viewUpgradeCost(s,e){i(this,Ms,null),q.mode===q.UPGRADING&&i(this,Ms,s.nextLevelUpgradeCost),i(this,ti,e)}viewSellProfit(s){i(this,xs,null),(q.mode===q.UPGRADING||q.mode===q.UPGRADING_MAX)&&i(this,xs,s.sellProfit)}hideUpgradeCost(){i(this,Ms,null)}hideSellProfit(){i(this,xs,null)}handleTowerButtons(s){U.greenTowerButton.isMouseOver(s)&&this.selectTower(Q.ID),U.redTowerButton.isMouseOver(s)&&this.selectTower(tt.ID),U.yellowTowerButton.isMouseOver(s)&&this.selectTower(st.ID)}};je=new WeakMap,Je=new WeakMap,Qe=new WeakMap,Ee=new WeakMap,Ms=new WeakMap,xs=new WeakMap,ti=new WeakMap,O=new WeakSet,bo=function(s){const e={x:0,y:28},n={w:800,h:50};return Le.isInsideRectangle(s,e,n)},Go=function(){U.greenTowerButton.on=t(this,je),U.redTowerButton.on=t(this,Je),U.yellowTowerButton.on=t(this,Qe),U.greenTowerButton.draw(),U.redTowerButton.draw(),U.yellowTowerButton.draw()},_o=function(){t(this,Ms)!==null&&(t(this,ti)||r.p5.fill("gray"),r.p5.text(t(this,Ms),33,72),h(this,O,$i).call(this))},ko=function(){t(this,xs)!==null&&r.p5.text(t(this,xs),182,72)},Yo=function(){t(this,je)||r.p5.fill("gray"),r.p5.text(Q.COST_UPGRADE[0],40,72),h(this,O,$i).call(this)},Xo=function(){t(this,Je)||r.p5.fill("gray"),r.p5.text(tt.COST_UPGRADE[0],118,72),h(this,O,$i).call(this)},Wo=function(){t(this,Qe)||r.p5.fill("gray"),r.p5.text(st.COST_UPGRADE[0],202,72),h(this,O,$i).call(this)},$i=function(){r.p5.fill("white")},Vo=function(){h(this,O,Yo).call(this),h(this,O,Xo).call(this),h(this,O,Wo).call(this)},Zo=function(){i(this,je,t(this,Ee).haveMoneyToBuyNewTower(Q.ID)),i(this,Je,t(this,Ee).haveMoneyToBuyNewTower(tt.ID)),i(this,Qe,t(this,Ee).haveMoneyToBuyNewTower(st.ID))},Is.ICON_GREEN_TOWER_ON=0,Is.ICON_GREEN_TOWER_OFF=1,Is.ICON_RED_TOWER_ON=0,Is.ICON_RED_TOWER_OFF=1,Is.ICON_YELLOW_TOWER_ON=0,Is.ICON_YELLOW_TOWER_OFF=1;let Rr=Is;var Ie,Dn,Pn;const ji=class ji extends Hr{constructor(e,n,o){super(n.position);a(this,Ie);a(this,Dn);a(this,Pn);i(this,Pn,e),i(this,Ie,n),i(this,Dn,o)}addDamage(e){e.addDamage(ji.DAMAGE)}draw(){r.p5.image(t(this,Pn),this.position.x,this.position.y)}updatePosition(){this.position=t(this,Ie).position}updateStatus(){t(this,Ie).isAlive?this.status=l.MAGIC_STATUS_ALIVE:this.status=l.MAGIC_STATUS_DEAD}update(e){t(this,Ie).update(),this.updatePosition(),this.updateStatus(),t(this,Dn).check(this,e.getAll())}};Ie=new WeakMap,Dn=new WeakMap,Pn=new WeakMap,ji.DAMAGE=500,ji.SPEED=10;let $a=ji;var Rs,si;const S=class S extends $s{constructor(e,n,o,c,I,p={x:0,y:0}){super(e,n,o,c);a(this,Rs);a(this,si);i(this,Rs,I),i(this,si,p)}removeItem(){D(this,Rs)._--}get items(){return t(this,Rs)}draw(){t(this,Rs)>0?this.isMouseOver({x:r.p5.mouseX,y:r.p5.mouseY})?this.drawHover():this.drawOn():this.drawOff(),r.p5.text(t(this,Rs),this.position.x+t(this,si).x,this.position.y+t(this,si).y)}static setImages(e,n,o){S.magicUFOButtonImages=e,S.magicFireballButtonImages=n,S.magicIceballButtonImages=o}static _initializeMagicUFOButton(){const e={x:498,y:28},n={w:118,h:50},o={x:44,y:3},c={x:93,y:47};S.magicUFOButton=new S(e,n,S.magicUFOButtonImages,o,S.magicTotalUFOItems,c)}static _initializeMagicFireballButton(){const e={x:616,y:28},n={w:78,h:50},o={x:20,y:3},c={x:64,y:47};S.magicFireballButton=new S(e,n,S.magicFireballButtonImages,o,S.magicTotalFireballItems,c)}static _initializeMagicIceballButton(){const e={x:692,y:28},n={w:103,h:50},o={x:33,y:3},c={x:77,y:47};S.magicIceballButton=new S(e,n,S.magicIceballButtonImages,o,S.magicTotalIceballItems,c)}static _initializeMagicButtons(){S._initializeMagicUFOButton(),S._initializeMagicFireballButton(),S._initializeMagicIceballButton()}static initializeButtons(){S._initializeMagicButtons()}};Rs=new WeakMap,si=new WeakMap,S.magicTotalUFOItems=3,S.magicTotalFireballItems=2,S.magicTotalIceballItems=2;let j=S;const dt=class dt extends Qi{constructor(s){super(s),this.particleSystem=new $r(r.p5.createVector(this.position.x+l.EXPLOSION_OFFSET,this.position.y+l.EXPLOSION_OFFSET),dt.SIZE,dt.COLOR)}static instantiate(s){dt.instances.push(new dt(s))}static updateInstances(){dt.instances.forEach(s=>{s.update()})}static removeDeadInstances(){dt.instances=dt.instances.filter(s=>s.alive)}};dt.SIZE=6,dt.COLOR=[202,191,24],dt.instances=[];let tn=dt;const Qs=class Qs{};Qs.ID_LEVEL_VALID_FOR_UNIT_TESTING=1,Qs.ID_LEVEL_INVALID_UNREACHABLE_ENDTILE_FOR_UNIT_TESTING=6666,Qs.ID_LEVEL_INVALID_WITHOUT_ROWSMAP_FOR_UNIT_TESTING=6667,Qs.DISABLE_EXPLOSION_FOR_UNIT_TESTING=!1,Qs.DISABLE_LOADING_IMAGES=!1;let Me=Qs;var ei,Nn;class Ec{constructor(s,e){a(this,ei);a(this,Nn);i(this,ei,s),i(this,Nn,e)}check(s,e){e.forEach(n=>{n.isAbducted||t(this,ei).checkCollision(n,t(this,Nn).indexOrder)&&this.handleCollision(s,n)})}handleCollision(s,e){s.addDamage(e),t(this,ei).setToIgnoreList(e),Me.DISABLE_EXPLOSION_FOR_UNIT_TESTING||tn.instantiate(e.position)}}ei=new WeakMap,Nn=new WeakMap;var Fn;class Ho{constructor(){a(this,Fn,[])}setToIgnoreList(s){t(this,Fn).push(s.id)}checkCollision(s,e){if(s.dead||s.winner||t(this,Fn).find(p=>p===s.id)!==void 0)return!1;const o=e,c=s.orderPosition,I=Math.abs(o-c);return o>=c&&I<1}}Fn=new WeakMap;var is,vn,Un,Cn,Bn,bn;const Rt=class Rt{constructor(s,e,n,o,c){a(this,vn);a(this,Un);a(this,Cn);a(this,Bn);a(this,bn);if(t(Rt,is)!==null)throw new Error("MagicFireballCreator is a singleton class, use getInstance to get the instance");i(this,vn,s),i(this,Un,e),i(this,Cn,n),i(this,Bn,o),i(this,bn,c),i(Rt,is,this)}static getInstance(s,e,n,o,c){return t(Rt,is)===null&&i(Rt,is,new Rt(s,e,n,o,c)),t(Rt,is)}static clearInstance(){i(Rt,is,null)}create(){const s=new zr(t(this,Cn),t(this,Bn),t(this,bn)),e=new Ho,n=new Ec(e,s);t(this,vn).add(new $a(t(this,Un),s,n))}};is=new WeakMap,vn=new WeakMap,Un=new WeakMap,Cn=new WeakMap,Bn=new WeakMap,bn=new WeakMap,a(Rt,is,null);let Dr=Rt;const Et=class Et extends Qi{constructor(s){super(s),this.particleSystem=new $r(r.p5.createVector(this.position.x+l.EXPLOSION_OFFSET,this.position.y+l.EXPLOSION_OFFSET),Et.SIZE,Et.COLOR)}static instantiate(s){Et.instances.push(new Et(s))}static updateInstances(){Et.instances.forEach(s=>{s.update()})}static removeDeadInstances(){Et.instances=Et.instances.filter(s=>s.alive)}};Et.SIZE=6,Et.COLOR=[0,65,255],Et.instances=[];let sn=Et;var ii,Gn;class Ic{constructor(s,e){a(this,ii);a(this,Gn);i(this,ii,s),i(this,Gn,e)}check(s,e){e.forEach(n=>{n.isAbducted||t(this,ii).checkCollision(n,t(this,Gn).indexOrder)&&this.handleCollision(s,n)})}handleCollision(s,e){s.freeze(e),t(this,ii).setToIgnoreList(e),sn.instantiate(e.position)}}ii=new WeakMap,Gn=new WeakMap;var ns,_n,kn,Yn,Xn,Wn;const Dt=class Dt{constructor(s,e,n,o,c){a(this,_n);a(this,kn);a(this,Yn);a(this,Xn);a(this,Wn);if(t(Dt,ns)!==null)throw new Error("MagicIceballCreator is a singleton class, use getInstance to get the instance");i(this,_n,s),i(this,kn,e),i(this,Yn,n),i(this,Xn,o),i(this,Wn,c),i(Dt,ns,this)}static getInstance(s,e,n,o,c){return t(Dt,ns)===null&&i(Dt,ns,new Dt(s,e,n,o,c)),t(Dt,ns)}static clearInstance(){i(Dt,ns,null)}create(){const s=new zr(t(this,Yn),t(this,Xn),t(this,Wn)),e=new Ho,n=new Ic(e,s);t(this,_n).add(new Ji(t(this,kn),s,n))}};ns=new WeakMap,_n=new WeakMap,kn=new WeakMap,Yn=new WeakMap,Xn=new WeakMap,Wn=new WeakMap,a(Dt,ns,null);let Pr=Dt;var ni,f,ai,Ds,Ps,Vn,Zn,Hn,ri,w,zo,$o,Ko,qo,jo,Jo,Qo,th,sh,eh,ih,nh,ah;const T=class T extends Hr{constructor(e,n,o,c){super(n);a(this,w);a(this,ni);a(this,f,null);a(this,ai,0);a(this,Ds,0);a(this,Ps,!1);a(this,Vn,!1);a(this,Zn,0);a(this,Hn);a(this,ri);i(this,ni,e),T.numberOfUFOs++,i(this,Zn,T.numberOfUFOs),i(this,Hn,o),i(this,ri,c)}get id(){return t(this,Zn)}draw(){h(this,w,$o).call(this),h(this,w,zo).call(this)}get enemyTarget(){return t(this,f)}update(e){t(this,f)&&t(this,f).alive?t(this,f).isAbducted?(h(this,w,Ko).call(this),h(this,w,Qo).call(this)):(h(this,w,eh).call(this),h(this,w,Jo).call(this),h(this,w,nh).call(this,e)):t(this,Vn)?h(this,w,qo).call(this):h(this,w,ih).call(this,e)}selectTarget(e){let n=0,o=null;e.getAll().forEach(c=>{const I=c.orderPosition;I>n&&!h(this,w,ah).call(this,c)&&(n=I,o=c)}),i(this,f,o)}};ni=new WeakMap,f=new WeakMap,ai=new WeakMap,Ds=new WeakMap,Ps=new WeakMap,Vn=new WeakMap,Zn=new WeakMap,Hn=new WeakMap,ri=new WeakMap,w=new WeakSet,zo=function(){r.p5.image(t(this,ni)[T.UFO_IMG_INDEX],this.position.x,this.position.y)},$o=function(){t(this,Ps)&&r.p5.image(t(this,ni)[T.UFO_RAY_IMG_INDEX],this.position.x+T.UFO_RAY_IMG_OFFSET_X,this.position.y+T.UFO_RAY_IMG_OFFSET_Y)},Ko=function(){t(this,f)&&(this.position.x<this.startPosition.x&&(this.position.x=this.position.x+T.SPEED),this.position.x>this.startPosition.x&&(this.position.x=this.position.x-T.SPEED),this.position.y<this.startPosition.y-T.OFFSET_Y&&(this.position.y=this.position.y+T.SPEED),this.position.y>this.startPosition.y-T.OFFSET_Y&&(this.position.y=this.position.y-T.SPEED))},qo=function(){this.position.y>T.OUT_OF_SCREEN_Y?this.position.y=this.position.y-T.SPEED:this.die()},jo=function(){return t(this,Ds)>0},Jo=function(){t(this,ri).isCollidingWithEnemy(this,t(this,f))?(i(this,Ps,!0),h(this,w,sh).call(this)):(i(this,Ps,!1),h(this,w,jo).call(this)&&(i(this,f,null),i(this,Ds,0)))},Qo=function(){if(t(this,ri).isCollidingWithStartPosition(this)){if(!t(this,f))return;t(this,f).dropFromUFO(),i(this,f,null),i(this,Ds,0),i(this,Vn,!0)}},th=function(){return t(this,Ps)&&t(this,f)},sh=function(){t(this,f)&&h(this,w,th).call(this)&&(t(this,Ds)<T.MAX_TIME_ABDUCT?D(this,Ds)._++:(t(this,f).decrementSize(),t(this,f).isAbducted&&i(this,Ps,!1)))},eh=function(){t(this,f)&&(this.position.x<t(this,f).position.x&&(this.position.x=this.position.x+T.SPEED),this.position.x>t(this,f).position.x&&(this.position.x=this.position.x-T.SPEED),this.position.y<t(this,f).position.y-T.OFFSET_Y&&(this.position.y=this.position.y+T.SPEED),this.position.y>t(this,f).position.y-T.OFFSET_Y&&(this.position.y=this.position.y-T.SPEED))},ih=function(e){t(this,ai)===l.TILE_SIZE?(this.selectTarget(e),i(this,ai,0)):D(this,ai)._++},nh=function(e){t(this,f)&&t(this,f).moveCount===0&&this.selectTarget(e)},ah=function(e){let n=!1;return t(this,Hn).getAll().forEach(o=>{"id"in o&&o.id!==this.id&&t(o,f)&&t(o,f).id===e.id&&(n=!0)}),n},T.SPEED=2,T.OFFSET_COLLISION_Y=50,T.OFFSET_Y=25,T.UFO_IMG_INDEX=0,T.UFO_RAY_IMG_INDEX=1,T.UFO_RAY_IMG_OFFSET_X=2,T.UFO_RAY_IMG_OFFSET_Y=30,T.MAX_TIME_ABDUCT=20,T.OUT_OF_SCREEN_Y=-50,T.numberOfUFOs=0;let en=T;var oi;class pc{constructor(s){a(this,oi);i(this,oi,s)}isCollidingWithEnemy(s,e){return e?Le.isInsideRectangle({x:s.position.x+l.TILE_SIZE/2,y:s.position.y+l.TILE_SIZE/2+en.OFFSET_COLLISION_Y},{x:e.position.x,y:e.position.y},{w:l.TILE_SIZE,h:l.TILE_SIZE}):!1}isCollidingWithStartPosition(s){return Le.isInsideRectangle({x:s.position.x+l.TILE_SIZE/2,y:s.position.y+l.TILE_SIZE/2+en.OFFSET_COLLISION_Y},{x:t(this,oi).x,y:t(this,oi).y},{w:l.TILE_SIZE,h:l.TILE_SIZE})}}oi=new WeakMap;var as,zn,hi,ci;const Pt=class Pt{constructor(s,e,n){a(this,zn);a(this,hi);a(this,ci);if(t(Pt,as)!==null)throw new Error("MagicUFOCreator is a singleton class, use getInstance to get the instance");i(this,zn,s),i(this,hi,e),i(this,ci,n),i(Pt,as,this)}static getInstance(s,e,n){return t(Pt,as)===null&&i(Pt,as,new Pt(s,e,n)),t(Pt,as)}static clearInstance(){i(Pt,as,null)}create(){const s=new pc(t(this,hi));t(this,ci).add(new en(t(this,zn),t(this,hi),t(this,ci),s))}};as=new WeakMap,zn=new WeakMap,hi=new WeakMap,ci=new WeakMap,a(Pt,as,null);let Nr=Pt;var cr,rh;class mc{constructor(){a(this,cr)}isInsideMagicsButtonsBar(s){return!!(h(this,cr,rh).call(this,s)&&s.x>495)}draw(){j.magicUFOButton.draw(),j.magicFireballButton.draw(),j.magicIceballButton.draw()}_instantiateMagicFireball(s,e,n,o){if(j.magicFireballButton.items===0)return;j.magicFireballButton.removeItem(),Dr.getInstance(o,s,e,n,$a.SPEED).create()}_instantiateMagicIceBall(s,e,n,o){if(j.magicIceballButton.items===0)return;j.magicIceballButton.removeItem(),Pr.getInstance(o,s,e,n,Ji.SPEED).create()}_instantiateMagicUFO(s,e,n){if(j.magicUFOButton.items===0)return;j.magicUFOButton.removeItem(),Nr.getInstance(s,e,n).create()}handleMagicButtons(s,e,n,o,c,I,p,V,Wa){j.magicFireballButton.isMouseOver(s)&&this._instantiateMagicFireball(n,c,I,p),j.magicIceballButton.isMouseOver(s)&&this._instantiateMagicIceBall(e,c,I,V),j.magicUFOButton.isMouseOver(s)&&this._instantiateMagicUFO(o,c,Wa)}}cr=new WeakSet,rh=function(s){const e={x:0,y:28},n={w:800,h:50};return Le.isInsideRectangle(s,e,n)};var li;class Tc extends Xa{constructor(e,n){super(e,n);a(this,li,l.BOSS_PROGRESS_DELAY)}updateBossProgressBar(){let e=!1;return t(this,li)>0?D(this,li)._--:(i(this,li,l.BOSS_PROGRESS_DELAY),this.increaseProgress(),this.isFullOfProgress()&&(this.reinitProgress(),e=!0)),e}}li=new WeakMap;var ui,$n;const lr=class lr extends Xa{constructor(e,n,o){super(e,n);a(this,ui,l.WAVE_PROGRESS_DELAY);a(this,$n);i(this,$n,o)}updateWaveProgressBar(){let e=!1;return t(this,ui)>0?D(this,ui)._--:(i(this,ui,l.WAVE_PROGRESS_DELAY),this.increaseProgress(),this.isFullOfProgress()&&(this.reinitProgress(),t(this,$n).increaseWave(),e=!0)),e}};ui=new WeakMap,$n=new WeakMap,lr.POSITION={x:335,y:-19},lr.SIZE={w:150,h:16};let Fr=lr;var Kn,pe,qn,jn,It,oh,hh,ch,lh,uh;class wc{constructor(s,e,n,o){a(this,It);a(this,Kn);a(this,pe);a(this,qn);a(this,jn);i(this,Kn,s),i(this,pe,e),i(this,qn,n),i(this,jn,o)}draw(){zs.setForHudData(),h(this,It,oh).call(this),h(this,It,hh).call(this),h(this,It,ch).call(this),h(this,It,lh).call(this),h(this,It,uh).call(this)}}Kn=new WeakMap,pe=new WeakMap,qn=new WeakMap,jn=new WeakMap,It=new WeakSet,oh=function(){r.p5.text(t(this,Kn).money,445,48)},hh=function(){r.p5.text(t(this,pe).lives,390,48)},ch=function(){r.p5.text(t(this,pe).getPrintScore(),404,73)},lh=function(){r.p5.text(`${t(this,qn)} by ${t(this,jn)}`,130,18)},uh=function(){r.p5.text(`wave ${t(this,pe).wave}`,403,13)};const z=class z{static _setGrayInfluenceAreaColor(){r.p5.stroke(...J.GRAY,z.ALPHA_STROKE),r.p5.fill(...J.GRAY,z.ALPHA_FILL)}static _setInfluenceAreaColor(s){switch(s){case Q.ID:r.p5.stroke(...J.GREEN,z.ALPHA_STROKE),r.p5.fill(...J.GREEN,z.ALPHA_FILL);break;case tt.ID:r.p5.stroke(...J.RED,z.ALPHA_STROKE),r.p5.fill(...J.RED,z.ALPHA_FILL);break;case st.ID:r.p5.stroke(...J.YELLOW,z.ALPHA_STROKE),r.p5.fill(...J.YELLOW,z.ALPHA_FILL);break}}static _getInfluenceAreaFor(s){let e=0;switch(s){case Q.ID:e=Q.UPGRADE_INFLUENCE_AREA[0];break;case tt.ID:e=tt.UPGRADE_INFLUENCE_AREA[0];break;case st.ID:e=st.UPGRADE_INFLUENCE_AREA[0];break}return e}static drawNoTowerInfluenceArea(s,e,n){n?z._setInfluenceAreaColor(e):z._setGrayInfluenceAreaColor(),z._drawCircle(s.x,s.y,z._getInfluenceAreaFor(e))}static drawTowerInfluenceArea(s,e){const n=s.position;let o=n.x,c=n.y;(s.type===Q.ID||s.type===tt.ID)&&(o+=l.TOWER_OFFSET,c+=l.TOWER_OFFSET),e?this._setInfluenceAreaColor(s.type):this._setGrayInfluenceAreaColor(),this._drawCircle(o,c,s.influenceArea)}static _drawCircle(s,e,n){r.p5.strokeWeight(2),r.p5.circle(s+l.TILE_SIZE/2,e+l.TILE_SIZE/2,n)}};z.ALPHA_FILL=50,z.ALPHA_STROKE=120;let Ki=z;var Jn,lt,gi,Ct,Qn,ta,sa,ea;class fc{constructor(s,e,n,o,c,I,p){a(this,Jn,null);a(this,lt);a(this,gi);a(this,Ct);a(this,Qn);a(this,ta);a(this,sa);a(this,ea);i(this,gi,s),i(this,lt,e),i(this,Ct,n),i(this,Qn,o),i(this,ta,c),i(this,sa,I),i(this,ea,p)}keyPressed(){switch(r.p5.keyCode){case l.KEY_1:t(this,lt).selectTower(Q.ID);break;case l.KEY_2:t(this,lt).selectTower(tt.ID);break;case l.KEY_3:t(this,lt).selectTower(st.ID);break}}get mouseTileOrangeOver(){return t(this,Jn)}set mouseTileOrangeOver(s){i(this,Jn,s)}mouseClicked(){const s={x:r.p5.mouseX,y:r.p5.mouseY};t(this,lt).isInsideTowersButtonsBar(s)?t(this,lt).handleTowerButtons(s):t(this,gi).isInsideMagicsButtonsBar(s)?t(this,gi).handleMagicButtons(s,u.magicIceballImage,u.magicFireballImage,u.magicUFOImages,t(this,ea),se.orders,t(this,Qn),t(this,ta),t(this,sa)):this.mouseTileOrangeOver!==null&&this.clicOrangeTile(this.mouseTileOrangeOver)}clicOrangeTile(s){const e=s.getTower();r.p5.mouseButton===r.p5.RIGHT&&e&&t(this,Ct).sellTower(e),r.p5.mouseButton===r.p5.LEFT&&(e?t(this,Ct).upgradeTower(e):t(this,Ct).buyTower(s,t(this,lt).getSelectedTower()))}drawInfluenceAreaWhenTowerExists(s){if(s)if(s.isMaxUpgraded)Ki.drawTowerInfluenceArea(s,!1);else{const e=t(this,Ct).haveMoneyToUpgradeTower(s.type,s.upgradeLevel+1);Ki.drawTowerInfluenceArea(s,e)}}drawInfluenceAreaWhenTowerNotExists(s){if(!s)return;const e=t(this,lt).getSelectedTower();Ki.drawNoTowerInfluenceArea(s,e,t(this,Ct).haveMoneyToBuyNewTower(e))}drawHudBackgroundWhenTowerExists(s){if(s){if(!s.isMaxUpgraded){const e=t(this,Ct).haveMoneyToUpgradeTower(s.type,s.upgradeLevel+1);t(this,lt).viewUpgradeCost(s,e)}t(this,lt).viewSellProfit(s)}}drawHudBackgroundWhenTowerNotExists(){}}Jn=new WeakMap,lt=new WeakMap,gi=new WeakMap,Ct=new WeakMap,Qn=new WeakMap,ta=new WeakMap,sa=new WeakMap,ea=new WeakMap;var Ns,ia;const Xt=class Xt{constructor(s){a(this,ia);if(t(Xt,Ns)!==null)throw new Error("TowerGreenCreator is a singleton class, use getInstance to get the instance");i(this,ia,s),i(Xt,Ns,this)}static getInstance(s){return t(Xt,Ns)===null&&i(Xt,Ns,new Xt(s)),t(Xt,Ns)}create(s,e){return new Q({x:s.x-l.TOWER_OFFSET,y:s.y-l.TOWER_OFFSET},e,t(this,ia))}};Ns=new WeakMap,ia=new WeakMap,a(Xt,Ns,null);let Ka=Xt;var Fs,na;const Wt=class Wt{constructor(s){a(this,na);if(t(Wt,Fs)!==null)throw new Error("TowerRedCreator is a singleton class, use getInstance to get the instance");i(this,na,s),i(Wt,Fs,this)}static getInstance(s){return t(Wt,Fs)===null&&i(Wt,Fs,new Wt(s)),t(Wt,Fs)}create(s,e){return new tt({x:s.x-l.TOWER_OFFSET,y:s.y-l.TOWER_OFFSET},e,t(this,na))}};Fs=new WeakMap,na=new WeakMap,a(Wt,Fs,null);let qa=Wt;var vs,aa,ra;const Vt=class Vt{constructor(s,e){a(this,aa);a(this,ra);if(t(Vt,vs)!==null)throw new Error("TowerYellowCreator is a singleton class, use getInstance to get the instance");i(this,aa,s),i(this,ra,e),i(Vt,vs,this)}static getInstance(s,e){return t(Vt,vs)===null&&i(Vt,vs,new Vt(s,e)),t(Vt,vs)}create(s,e){return new st({x:s.x-l.TOWER_OFFSET,y:s.y-l.TOWER_OFFSET},e,t(this,ra),t(this,aa))}};vs=new WeakMap,aa=new WeakMap,ra=new WeakMap,a(Vt,vs,null);let ja=Vt;class bi{static showMouseCoordinates(s,e){const n=Math.round(s.x),o=Math.round(s.y);zs.setForHudData(),r.p5.text(`x:${n}, y:${o}`,e.x,e.y)}static showLabelTestingMode(s){zs.setForHudData(),r.p5.text("The game is in testing mode",s.x,s.y)}}var oa,me,ha,Te,we;class gh{constructor(){a(this,oa,[]);a(this,me,[]);a(this,ha,[]);a(this,Te,null);a(this,we,null)}get getAllOrangeTiles(){return t(this,me)}get getAllBlackTiles(){return t(this,me)}get getAllPathTiles(){return t(this,ha)}get tileStart(){return t(this,Te)}get tileEnd(){return t(this,we)}addOrangeTile(s){t(this,me).push(s)}addBlackTile(s){t(this,oa).push(s)}addPathTile(s){t(this,ha).push(s)}set tileStart(s){i(this,Te,s)}set tileEnd(s){i(this,we,s)}drawAll(s=1,e=0,n=0){if(t(this,Te)===null||t(this,we)===null)throw new Error("Error: tileStart or tileEnd is null");t(this,Te).draw(s,e,n),t(this,we).draw(s,e,n),t(this,me).forEach(o=>{o.drawTile(s,e,n)}),t(this,oa).forEach(o=>{o.drawTile(s,e,n)})}}oa=new WeakMap,me=new WeakMap,ha=new WeakMap,Te=new WeakMap,we=new WeakMap;var di,b,ur,ca,la,ua;class Ac extends ct{constructor(e,n,o,c,I,p){super(n);a(this,di);a(this,b,null);a(this,ur);a(this,ca);a(this,la);a(this,ua);i(this,di,e),i(this,ur,o),i(this,ca,c),i(this,la,I),i(this,ua,p)}removeTower(){i(this,b,null)}instantiateNewTower(e){switch(e){case Q.ID:i(this,b,t(this,ca).create(this.position,this));break;case tt.ID:i(this,b,t(this,la).create(this.position,this));break;case st.ID:i(this,b,t(this,ua).create(this.position,this));break}}drawTile(e,n,o){t(this,di)!==null&&r.p5.image(t(this,di),this.position.x/e+n,this.position.y/e+o,l.TILE_SIZE/e,l.TILE_SIZE/e)}drawTower(){t(this,b)&&t(this,b).draw()}updateTower(){t(this,b)&&t(this,b).update()}selectTarget(e){t(this,b)&&(t(this,b).type===st.ID&&"selectAllExplosionsTargets"in t(this,b)&&t(this,b).selectAllExplosionsTargets(),t(this,b).selectTarget(e))}isInside(e,n){let o=!1,c=!1;return this.position.x<e&&this.position.x+l.TILE_SIZE>e&&(o=!0),this.position.y<n&&this.position.y+l.TILE_SIZE>n&&(c=!0),!!(o&&c)}hasTower(){return t(this,b)!==null}getTower(){return this.hasTower()?t(this,b):null}}di=new WeakMap,b=new WeakMap,ur=new WeakMap,ca=new WeakMap,la=new WeakMap,ua=new WeakMap;var rs,ga,da,Ea,Ia,pa,Xi,dh,Eh;const _=class _{constructor(s,e,n,o,c){a(this,Xi);a(this,ga,null);a(this,da);a(this,Ea);a(this,Ia);a(this,pa);if(t(_,rs)!==null)throw new Error("TileOrangeCreator is a singleton class, use getInstance to get the instance");i(this,da,e),Me.DISABLE_LOADING_IMAGES||i(this,ga,s[0]),i(this,Ea,n),i(this,Ia,o),i(this,pa,c),i(_,rs,this)}static getInstance(s,e,n,o,c){return t(_,rs)===null&&i(_,rs,new _(s,e,n,o,c)),t(_,rs)}static clearInstance(){i(_,rs,null)}createAll(s,e){let n=0;s.rowsMap.forEach(o=>{const c=o.trim();n++,h(this,Xi,Eh).call(this,e,c,n)})}};rs=new WeakMap,ga=new WeakMap,da=new WeakMap,Ea=new WeakMap,Ia=new WeakMap,pa=new WeakMap,Xi=new WeakSet,dh=function(s,e,n){s.addOrangeTile(new Ac(t(this,ga),{x:e,y:n},t(this,da),t(this,Ea),t(this,Ia),t(this,pa)))},Eh=function(s,e,n){for(let o=0;o<e.length;o++){const c=e[o],I=_.FLOOR_SIZE*o,p=_.FLOOR_SIZE*n+_.MARGIN_TOP;c===_.SYMBOL&&h(this,Xi,dh).call(this,s,I,p)}},a(_,rs,null),_.FLOOR_SIZE=50,_.MARGIN_TOP=30,_.SYMBOL="0";let Ja=_;var Ei,ma;class Oc extends ct{constructor(e,n,o){super(n);a(this,Ei);a(this,ma);i(this,Ei,e),i(this,ma,o)}draw(e,n,o){t(this,Ei)&&r.p5.image(t(this,Ei),this.position.x/e+n,this.position.y/e+o,l.TILE_SIZE/e,l.TILE_SIZE/e)}getStartDirection(){return t(this,ma)}}Ei=new WeakMap,ma=new WeakMap;var os,Bt,qs,Ih,ph,mh;const k=class k{constructor(s){a(this,qs);a(this,Bt,null);if(t(k,os)!==null)throw new Error("TileStartCreator is a singleton class, use getInstance to get the instance");Me.DISABLE_LOADING_IMAGES||i(this,Bt,s),i(k,os,this)}static getInstance(s){return t(k,os)===null&&i(k,os,new k(s)),t(k,os)}static clearInstance(){i(k,os,null)}create(s,e){let n=0;s.rowsMap.forEach(o=>{const c=o.trim();n++,h(this,qs,mh).call(this,s,e,c,n)})}};os=new WeakMap,Bt=new WeakMap,qs=new WeakSet,Ih=function(s){if(t(this,Bt)===null)return null;switch(s.startDirection){case E.DOWN:return t(this,Bt)[6];case E.RIGHT:return t(this,Bt)[7];case E.LEFT:return t(this,Bt)[8];case E.UP:return t(this,Bt)[9];default:return t(this,Bt)[8]}},ph=function(s,e,n,o){let c=h(this,qs,Ih).call(this,s);e.tileStart=new Oc(c,{x:n,y:o},s.startDirection)},mh=function(s,e,n,o){for(let c=0;c<n.length;c++){const I=n[c],p=k.FLOOR_SIZE*c,V=k.FLOOR_SIZE*o+k.MARGIN_TOP;I===k.SYMBOL&&h(this,qs,ph).call(this,s,e,p,V)}},a(k,os,null),k.FLOOR_SIZE=50,k.MARGIN_TOP=30,k.SYMBOL="x";let Qa=k;var Ii;class yc extends ct{constructor(e,n){super(n);a(this,Ii);i(this,Ii,e)}draw(e,n,o){t(this,Ii)&&r.p5.image(t(this,Ii),this.position.x/e+n,this.position.y/e+o,l.TILE_SIZE/e,l.TILE_SIZE/e)}}Ii=new WeakMap;var hs,bt,js,Th,wh,fh;const Y=class Y{constructor(s){a(this,js);a(this,bt,null);if(t(Y,hs)!==null)throw new Error("TileEndCreator is a singleton class, use getInstance to get the instance");Me.DISABLE_LOADING_IMAGES||i(this,bt,s),i(Y,hs,this)}static getInstance(s){return t(Y,hs)===null&&i(Y,hs,new Y(s)),t(Y,hs)}static clearInstance(){i(Y,hs,null)}create(s,e){let n=0;s.rowsMap.forEach(o=>{const c=o.trim();n++,h(this,js,fh).call(this,e,s,c,n)})}};hs=new WeakMap,bt=new WeakMap,js=new WeakSet,Th=function(s,e,n,o){const c=h(this,js,wh).call(this,e);s.tileEnd=new yc(c,{x:n,y:o})},wh=function(s){if(t(this,bt)===null)return null;switch(s.endDirection){case E.DOWN:return t(this,bt)[5];case E.RIGHT:return t(this,bt)[4];case E.LEFT:return t(this,bt)[3];case E.UP:return t(this,bt)[2];default:return t(this,bt)[3]}},fh=function(s,e,n,o){for(let c=0;c<n.length;c++){const I=n[c],p=Y.FLOOR_SIZE*c,V=Y.FLOOR_SIZE*o+Y.MARGIN_TOP;I===Y.SYMBOL&&h(this,js,Th).call(this,s,e,p,V)}},a(Y,hs,null),Y.FLOOR_SIZE=50,Y.MARGIN_TOP=30,Y.SYMBOL="y";let tr=Y;var cs,Wi,Ah,Oh;const X=class X{constructor(){a(this,Wi);if(t(X,cs)!==null)throw new Error("TilePathCreator is a singleton class, use getInstance to get the instance");i(X,cs,this)}static getInstance(){return t(X,cs)===null&&i(X,cs,new X),t(X,cs)}static clearInstance(){i(X,cs,null)}createAll(s,e){let n=0;s.rowsMap.forEach(o=>{const c=o.trim();n++,h(this,Wi,Oh).call(this,e,c,n)})}};cs=new WeakMap,Wi=new WeakSet,Ah=function(s,e,n){s.addPathTile(new lo({x:e,y:n}))},Oh=function(s,e,n){for(let o=0;o<e.length;o++){const c=e[o],I=X.FLOOR_SIZE*o,p=X.FLOOR_SIZE*n+X.MARGIN_TOP;c===X.SYMBOL&&h(this,Wi,Ah).call(this,s,I,p)}},a(X,cs,null),X.FLOOR_SIZE=50,X.MARGIN_TOP=30,X.SYMBOL="1";let sr=X;var Us,fe;const Zt=class Zt{constructor(){a(this,fe,null);if(t(Zt,Us)!==null)throw new Error("PathStartEnemiesPosition is a singleton class, use getInstance to get the instance");i(Zt,Us,this)}static getInstance(){return t(Zt,Us)===null&&i(Zt,Us,new Zt),t(Zt,Us)}set tileStart(s){i(this,fe,s)}get(){if(t(this,fe)===null)throw new Error("tileStart is null");let s=0,e=0;const n=t(this,fe).position;switch(t(this,fe).getStartDirection()){case E.RIGHT:s=n.x-l.TILE_SIZE,e=n.y;break;case E.UP:s=n.x,e=n.y+l.TILE_SIZE;break;case E.DOWN:s=n.x,e=n.y-l.TILE_SIZE;break;default:s=n.x+l.TILE_SIZE,e=n.y;break}return{x:s,y:e}}};Us=new WeakMap,fe=new WeakMap,a(Zt,Us,null);let vr=Zt;var pi;class Sc extends ct{constructor(e,n){super(n);a(this,pi,null);i(this,pi,e)}drawTile(e,n,o){t(this,pi)!==null&&r.p5.image(t(this,pi),this.position.x/e+n,this.position.y/e+o,l.TILE_SIZE/e,l.TILE_SIZE/e)}isInside(e,n){let o=!1,c=!1;return this.position.x<e&&this.position.x+l.TILE_SIZE>e&&(o=!0),this.position.y<n&&this.position.y+l.TILE_SIZE>n&&(c=!0),!!(o&&c)}}pi=new WeakMap;var ls,Ta,Vi,yh,Sh;const W=class W{constructor(s){a(this,Vi);a(this,Ta,null);if(t(W,ls)!==null)throw new Error("TileBlackCreator is a singleton class, use getInstance to get the instance");Me.DISABLE_LOADING_IMAGES||i(this,Ta,s[1]),i(W,ls,this)}static getInstance(s){return t(W,ls)===null&&i(W,ls,new W(s)),t(W,ls)}static clearInstance(){i(W,ls,null)}createAll(s,e){let n=0;s.rowsMap.forEach(o=>{const c=o.trim();n++,h(this,Vi,Sh).call(this,e,c,n)})}};ls=new WeakMap,Ta=new WeakMap,Vi=new WeakSet,yh=function(s,e,n){s.addBlackTile(new Sc(t(this,Ta),{x:e,y:n}))},Sh=function(s,e,n){for(let o=0;o<e.length;o++){const c=e[o],I=W.FLOOR_SIZE*o,p=W.FLOOR_SIZE*n+W.MARGIN_TOP;c===W.SYMBOL&&h(this,Vi,yh).call(this,s,I,p)}},a(W,ls,null),W.FLOOR_SIZE=50,W.MARGIN_TOP=30,W.SYMBOL="2";let nn=W;var Cs,mi,ut,Bs,bs,Gs,ot,Ot,Ti,wi,Ae,fi,Ai,Oi,F,wa,yi,fa,Aa,gr,$,Oa,Si,ya,Sa,La,_s,g,Lh,Mh,xh,Rh,Dh,Ph,Nh,Fh,vh,Uh,Cr,Ch,Bh,bh,Br,Gh,_h,kh,Yh,Xh,Wh,Vh,Zh,Hh,zh,$h,Kh,qh,jh;const Ht=class Ht{constructor(s,e){a(this,g);a(this,mi);a(this,ut);a(this,Bs);a(this,bs);a(this,Gs);a(this,ot);a(this,Ot,null);a(this,Ti);a(this,wi);a(this,Ae,null);a(this,fi);a(this,Ai);a(this,Oi,null);a(this,F,null);a(this,wa);a(this,yi,0);a(this,fa,!1);a(this,Aa,!1);a(this,gr);a(this,$);a(this,Oa);a(this,Si);a(this,ya,null);a(this,Sa,null);a(this,La,null);a(this,_s,{x:0,y:0});if(t(Ht,Cs)!==null)throw new Error("Game is a singleton class. Use getInstance to get the instance of the Game.");i(this,wa,e),i(this,gr,s),i(this,ot,new dc),i(this,mi,new gc(t(this,ot))),i(this,Bs,new pr(t(this,ot))),i(this,bs,new pr(t(this,ot))),i(this,Gs,new pr(t(this,ot))),i(this,ut,Ha.getInstance());const n=Ka.getInstance(u.greenTowerImages),o=qa.getInstance(u.redTowerImages),c=ja.getInstance(u.yellowTowerImages,t(this,ut));i(this,$,new gh),i(this,Si,nn.getInstance(u.tileImages)),i(this,Oa,Ja.getInstance(u.tileImages,t(this,ut),n,o,c)),j.setImages(u.magicUFOButtonImages,u.magicFireballButtonImages,u.magicIceballButtonImages),j.initializeButtons(),U.setImages(u.towerGreenButtonImages,u.towerRedButtonImages,u.towerYellowButtonImages),U.initializeButtons(),i(this,Ti,new q(u.hudImages)),i(this,wi,new mc),i(this,fi,h(this,g,Lh).call(this)),i(this,Ai,h(this,g,Mh).call(this)),i(Ht,Cs,this)}static getInstance(s,e){return t(Ht,Cs)===null&&i(Ht,Cs,new Ht(s,e)),t(Ht,Cs)}loadLevel(s){const e=t(this,wa).getById(s);i(this,Ot,za.getInstance(za.GAME_TESTING_MODE,e.money)),i(this,Ae,new Rr(t(this,Ot))),i(this,Oi,new wc(t(this,Ot),t(this,ut),e.title,e.author)),h(this,g,xh).call(this,e);const n=t(this,$).getAllPathTiles,o=t(this,$).tileStart,c=t(this,$).tileEnd;if(o===null||c===null)throw new Error("Map invalid: tileStart or tileEnd is null");const I=new se(o,c,n);if(se.orders=I.makeOrders(),se.orders.length===0)throw new Error("Empty orders");const p=vr.getInstance();p.tileStart=o,i(this,_s,p.get()),t(this,Oa).createAll(e,t(this,$)),i(this,F,new fc(t(this,wi),t(this,Ae),t(this,Ot),t(this,Bs),t(this,bs),t(this,Gs),t(this,_s)))}mouseClicked(){if(t(this,F)===null)throw new Error("controls is null");t(this,F).mouseClicked()}keyPressed(){if(t(this,F)===null)throw new Error("controls is null");t(this,F).keyPressed()}update(){h(this,g,vh).call(this)}draw(){if(t(this,Ot)===null)throw new Error("wallet is null");t(this,yi)===l.GAME_STATUS_PLAYING&&h(this,g,zh).call(this),h(this,g,Hh).call(this),t(this,$).drawAll(),h(this,g,Uh).call(this),h(this,g,Kh).call(this),h(this,g,bh).call(this),h(this,g,Dh).call(this),h(this,g,Vh).call(this),h(this,g,Zh).call(this),t(this,yi)===l.GAME_STATUS_GAME_OVER&&h(this,g,qh).call(this),ye.removeDeadInstances(),ye.drawInstances(),t(this,Ot).isGameInTestingMode()&&h(this,g,jh).call(this)}};Cs=new WeakMap,mi=new WeakMap,ut=new WeakMap,Bs=new WeakMap,bs=new WeakMap,Gs=new WeakMap,ot=new WeakMap,Ot=new WeakMap,Ti=new WeakMap,wi=new WeakMap,Ae=new WeakMap,fi=new WeakMap,Ai=new WeakMap,Oi=new WeakMap,F=new WeakMap,wa=new WeakMap,yi=new WeakMap,fa=new WeakMap,Aa=new WeakMap,gr=new WeakMap,$=new WeakMap,Oa=new WeakMap,Si=new WeakMap,ya=new WeakMap,Sa=new WeakMap,La=new WeakMap,_s=new WeakMap,g=new WeakSet,Lh=function(){const s={x:345,y:17},e={w:150,h:10};return new Tc(s,e)},Mh=function(){const s={x:345,y:1},e={w:150,h:16};return new Fr(s,e,t(this,ut))},xh=function(s){i(this,ya,Qa.getInstance(u.tileImages)),t(this,ya).create(s,t(this,$)),i(this,Sa,tr.getInstance(u.tileImages)),t(this,Sa).create(s,t(this,$)),i(this,La,sr.getInstance()),t(this,La).createAll(s,t(this,$)),i(this,Si,nn.getInstance(u.tileImages)),t(this,Si).createAll(s,t(this,$))},Rh=function(){t(this,Bs).updateInstances(),t(this,Bs).removeDeadInstances(),t(this,bs).updateInstances(),t(this,bs).removeDeadInstances(),t(this,Gs).updateInstances(),t(this,Gs).removeDeadInstances()},Dh=function(){t(this,Bs).drawInstances(),t(this,bs).drawInstances(),t(this,Gs).drawInstances()},Ph=function(){const s=h(this,g,_h).call(this),e=h(this,g,Br).call(this,v.BOSS_VELOCITY);t(this,mi).createBoss(t(this,_s),t(this,ut).wave,s,e)},Nh=function(){let s=l.GAME_STATUS_PLAYING;return t(this,ot).getAll().filter(n=>n.winner).forEach(n=>{t(this,ut).decreaseLives(),t(this,ut).lives<=0&&(s=l.GAME_STATUS_GAME_OVER),n.resetWinner()}),s},Fh=function(){t(this,ot).getAll().filter(e=>e.dead).forEach(e=>{if(t(this,Ot)===null)throw new Error("wallet is null");ve.instantiate(e.position);const n=e.endurance*l.MONEY_MULTIPLICATOR;t(this,Ot).increaseMoney(n),t(this,ut).increaseScore(n*2)})},vh=function(){t(this,$).getAllOrangeTiles.forEach(s=>{s.selectTarget(t(this,ot).getAll())})},Uh=function(){t(this,$).getAllOrangeTiles.forEach(s=>{s.updateTower(),s.drawTower()})},Cr=function(){if(t(this,F)===null)throw new Error("controls is null");return t(this,F).mouseTileOrangeOver!==null},Ch=function(){if(t(this,F)===null)throw new Error("controls is null");if(t(this,g,Cr)){const s=t(this,F).mouseTileOrangeOver;s!=null&&s.hasTower()?t(this,F).drawHudBackgroundWhenTowerExists(s.getTower()):t(this,F).drawHudBackgroundWhenTowerNotExists()}else t(this,Ti).drawNormalHud()},Bh=function(){if(t(this,F)===null)throw new Error("controls is null");if(t(this,g,Cr)){const s=t(this,F).mouseTileOrangeOver;s!=null&&s.hasTower()?t(this,F).drawInfluenceAreaWhenTowerExists(s.getTower()):t(this,F).drawInfluenceAreaWhenTowerNotExists(s==null?void 0:s.position)}},bh=function(){if(t(this,Ae)===null||t(this,Oi)===null)throw new Error("hudButtonsTower or hudOtherIndicators is null");t(this,Ti).draw(),h(this,g,Ch).call(this),h(this,g,Bh).call(this),t(this,Ae).draw(),t(this,wi).draw(),t(this,Ai).draw(),t(this,fi).draw(),t(this,Oi).draw()},Br=function(s){return new zr(t(this,_s),se.orders,s)},Gh=function(){return new Fe(u.enemiesImages.slice(...te.getTwoNumbersFourTimes(v.waveEnemies)))},_h=function(){return new Fe(u.enemiesImages.slice(...te.getTwoNumbersFourTimes(Fe.INDEX_BOSS_IN_ENEMIES_IMAGES)))},kh=function(){const s=h(this,g,Gh).call(this),e=h(this,g,Br).call(this,v.VELOCITY);t(this,mi).createNormal(v.waveEnemies,t(this,_s),t(this,ut).wave,s,e)},Yh=function(){v.allowCreateEnemies&&(v.waveEnemies<v.TOTAL_ENEMIES?(v.createEnemyTime++,v.createEnemyTime===v.CREATION_MAX_TIME&&(h(this,g,kh).call(this),v.createEnemyTime=0,v.waveEnemies++)):h(this,g,Xh).call(this))},Xh=function(){v.allowCreateEnemies=!1,v.waveEnemies=0},Wh=function(){return h(this,g,Yh).call(this),h(this,g,Fh).call(this),t(this,ot).removeDeadInstances(),t(this,ot).updateInstances(),h(this,g,Nh).call(this)},Vh=function(){ve.removeDeadInstances(),tn.removeDeadInstances(),sn.removeDeadInstances(),ve.updateInstances(),tn.updateInstances(),sn.updateInstances()},Zh=function(){gs.removeDeadInstances(),gs.updateInstances(),gs.drawInstances()},Hh=function(){r.p5.background("skyblue"),r.p5.rectMode(r.p5.CORNER),r.p5.image(u.backgroundImage,0,q.HEIGHT)},zh=function(){if(t(this,F)===null)throw new Error("controls is null");i(this,yi,h(this,g,Wh).call(this)),t(this,F).mouseTileOrangeOver=h(this,g,$h).call(this),i(this,Aa,t(this,Ai).updateWaveProgressBar()),i(this,fa,t(this,fi).updateBossProgressBar()),t(this,fa)&&h(this,g,Ph).call(this),t(this,Aa)&&(v.allowCreateEnemies=!0),h(this,g,Rh).call(this),ye.updateInstances()},$h=function(){const s=t(this,$).getAllOrangeTiles.find(e=>e.isInside(r.p5.mouseX,r.p5.mouseY));return s||null},Kh=function(){t(this,ot).drawInstances()},qh=function(){zs.setForBigCenteredTitle(),r.p5.text("Game over",r.p5.width/2,r.p5.height/2)},jh=function(){bi.showMouseCoordinates({x:r.p5.mouseX,y:r.p5.mouseY},{x:260,y:18}),bi.showLabelTestingMode({x:8,y:100})},a(Ht,Cs,null);let Ur=Ht;var ks,Ys;const et=class et{constructor(s){a(this,Ys);if(t(et,ks)!==null)throw new Error("StateManager is a singleton class, use getInstance to get the instance");i(this,Ys,s),i(et,ks,this)}static getInstance(s){return t(et,ks)===null&&i(et,ks,new et(s)),t(et,ks)}setPlay(){i(this,Ys,et.STATE_PLAY_SURVIVAL)}setMenuSurvival(){i(this,Ys,et.STATE_MENU_SURVIVAL)}setMenuMain(){i(this,Ys,et.STATE_MENU_MAIN)}get state(){return t(this,Ys)}};ks=new WeakMap,Ys=new WeakMap,et.STATE_MENU_MAIN=0,et.STATE_MENU_SURVIVAL=1,et.STATE_PLAY_SURVIVAL=2,a(et,ks,null);let St=et;var Gt,Ma,xa,Ra,Da,Pa,Li,Mi,xi,Ri,Na,K,Zi,Jh,Qh;const Pe=class Pe{constructor(s,e,n={x:0,y:0}){a(this,Zi);a(this,Gt);a(this,Ma);a(this,xa);a(this,Ra);a(this,Da);a(this,Pa);a(this,Li);a(this,Mi);a(this,xi);a(this,Ri);a(this,Na);a(this,K);i(this,K,n),i(this,Mi,e),i(this,xi,s.author),i(this,Ri,s.title),i(this,Na,s.id),i(this,Li,Ha.getInstance());const o=Ka.getInstance(u.greenTowerImages),c=qa.getInstance(u.redTowerImages),I=ja.getInstance(u.yellowTowerImages,t(this,Li));i(this,Gt,new gh),i(this,Ma,nn.getInstance(u.tileImages)),t(this,Ma).createAll(s,t(this,Gt)),i(this,xa,Ja.getInstance(u.tileImages,t(this,Li),o,c,I)),t(this,xa).createAll(s,t(this,Gt)),i(this,Ra,Qa.getInstance(u.tileImages)),t(this,Ra).create(s,t(this,Gt)),i(this,Da,tr.getInstance(u.tileImages)),t(this,Da).create(s,t(this,Gt)),i(this,Pa,sr.getInstance()),t(this,Pa).createAll(s,t(this,Gt))}get levelId(){return t(this,Na)}set position(s){t(this,K).x=s.x,t(this,K).y=s.y}draw(){t(this,Gt).drawAll(l.SCALE_MINIMAP,t(this,K).x,t(this,K).y),zs.setForHudData(),t(this,Mi)===Pe.TYPE_TEXT_LEFT?h(this,Zi,Jh).call(this):t(this,Mi)===Pe.TYPE_TEXT_DOWN&&h(this,Zi,Qh).call(this)}};Gt=new WeakMap,Ma=new WeakMap,xa=new WeakMap,Ra=new WeakMap,Da=new WeakMap,Pa=new WeakMap,Li=new WeakMap,Mi=new WeakMap,xi=new WeakMap,Ri=new WeakMap,Na=new WeakMap,K=new WeakMap,Zi=new WeakSet,Jh=function(){r.p5.text(t(this,Ri),t(this,K).x,t(this,K).y+102),r.p5.text(`By ${t(this,xi)}`,t(this,K).x,t(this,K).y+118)},Qh=function(){r.p5.text(t(this,Ri),t(this,K).x-170,t(this,K).y+71),r.p5.text(`By ${t(this,xi)}`,t(this,K).x-170,t(this,K).y+88)},Pe.TYPE_TEXT_DOWN=1,Pe.TYPE_TEXT_LEFT=2;let Gi=Pe;var Fa;class Lc{constructor(s){a(this,Fa,[]);i(this,Fa,s)}draw(){const s={x:20,y:460},e={w:50,h:50},n=59;let o=0;for(const c of t(this,Fa))r.p5.image(c.imageToDraw,s.x+o*n,s.y,e.w,e.h),o++}}Fa=new WeakMap;class to extends $s{constructor(s,e,n,o={x:0,y:0}){super(s,e,n,o)}draw(){this.drawOff()}}var Xs,Oe,Di,Pi,Ni,va,Ua,dr,Fi,Ca,Ba,ht,tc,sc,ec,ic,nc,ac;const zt=class zt{constructor(s,e,n,o){a(this,ht);a(this,Oe);a(this,Di,[]);a(this,Pi,[]);a(this,Ni);a(this,va);a(this,Ua);a(this,dr);a(this,Fi);a(this,Ca,null);a(this,Ba);if(t(zt,Xs)!==null)throw new Error("MenuMain is a singleton class, use getInstance to get the instance");i(this,Oe,s),i(this,dr,e),i(this,Fi,n),i(this,Ba,o.last.content);const c=[8];i(this,Di,e.createOneRow(c,Gi.TYPE_TEXT_DOWN,{x:637,y:207}));const I=[1,14,13];i(this,Pi,e.createOneRow(I,Gi.TYPE_TEXT_LEFT,{x:336,y:452})),i(this,Ni,new $s({x:480,y:110},{w:103,h:31},u.buttonSurvivalImages)),i(this,Ua,new to({x:600,y:110},{w:132,h:31},u.buttonTodaysImages)),i(this,va,new to({x:455,y:206},{w:129,h:31},u.buttonEditorImages));const p=[];for(let V=0;V<l.MAX_WAVE_ENEMIES;V++)p.push(new Fe(u.enemiesImages.slice(...te.getTwoNumbersFourTimes(V))));i(this,Ca,new Lc(p)),i(zt,Xs,this)}static getInstance(s,e,n,o){return t(zt,Xs)===null&&i(zt,Xs,new zt(s,e,n,o)),t(zt,Xs)}mouseClicked(){const s={x:r.p5.mouseX,y:r.p5.mouseY};t(this,Ni).isMouseOver(s)&&t(this,Oe).setMenuSurvival();for(const e of t(this,Di))if(e.isMouseOver(s)){const n=e.miniMap.levelId;t(this,Fi).loadLevel(n),t(this,Oe).setPlay()}for(const e of t(this,Pi))if(e.isMouseOver(s)){const n=e.miniMap.levelId;t(this,Fi).loadLevel(n),t(this,Oe).setPlay()}}update(){}draw(){var s;h(this,ht,sc).call(this),(s=t(this,Ca))==null||s.draw(),h(this,ht,ec).call(this),h(this,ht,ac).call(this),h(this,ht,ic).call(this),h(this,ht,nc).call(this),h(this,ht,tc).call(this)}};Xs=new WeakMap,Oe=new WeakMap,Di=new WeakMap,Pi=new WeakMap,Ni=new WeakMap,va=new WeakMap,Ua=new WeakMap,dr=new WeakMap,Fi=new WeakMap,Ca=new WeakMap,Ba=new WeakMap,ht=new WeakSet,tc=function(){bi.showMouseCoordinates({x:r.p5.mouseX,y:r.p5.mouseY},{x:355,y:15}),bi.showLabelTestingMode({x:170,y:15})},sc=function(){r.p5.background("skyblue"),r.p5.rectMode(r.p5.CORNER),r.p5.image(u.menuMain,0,0,800,580)},ec=function(){const s={x:440,y:65};r.p5.text(t(this,Ba),s.x,s.y)},ic=function(){t(this,Ni).draw(),t(this,va).draw(),t(this,Ua).draw()},nc=function(){for(const s of t(this,Pi))s.draw()},ac=function(){for(const s of t(this,Di))s.draw()},a(zt,Xs,null);let br=zt;var Ws,vi,Ui,Ci,ba,Ga,Js,rc,oc,hc;const $t=class $t{constructor(s,e,n){a(this,Js);a(this,vi);a(this,Ui,[]);a(this,Ci);a(this,ba);a(this,Ga);if(t($t,Ws)!==null)throw new Error("MenuSurvival is a singleton class, use getInstance to get the instance");i(this,vi,s),i(this,ba,e),i(this,Ga,n);const o=[1,13,14,9,15,8,10,11,12,16,22,26];i(this,Ui,t(this,ba).createMultiRows(o,Gi.TYPE_TEXT_LEFT,{x:28,y:160})),i(this,Ci,new $s({x:610,y:520},{w:166,h:31},u.buttonMenuMainImages)),i($t,Ws,this)}static getInstance(s,e,n){return t($t,Ws)===null&&i($t,Ws,new $t(s,e,n)),t($t,Ws)}mouseClicked(){const s={x:r.p5.mouseX,y:r.p5.mouseY};t(this,Ci).isMouseOver(s)&&t(this,vi).setMenuMain();for(const e of t(this,Ui))if(e.isMouseOver(s)){const n=e.miniMap.levelId;t(this,Ga).loadLevel(n),t(this,vi).setPlay()}}update(){}draw(){h(this,Js,oc).call(this),t(this,Ci).draw(),h(this,Js,hc).call(this),h(this,Js,rc).call(this)}};Ws=new WeakMap,vi=new WeakMap,Ui=new WeakMap,Ci=new WeakMap,ba=new WeakMap,Ga=new WeakMap,Js=new WeakSet,rc=function(){bi.showMouseCoordinates({x:r.p5.mouseX,y:r.p5.mouseY},{x:355,y:15}),bi.showLabelTestingMode({x:170,y:15})},oc=function(){r.p5.background("skyblue"),r.p5.rectMode(r.p5.CORNER),r.p5.image(u.menuSurvival,0,0,800,580)},hc=function(){for(const s of t(this,Ui))s.draw()},a($t,Ws,null);let Gr=$t;var _a,Vs;const Kt=class Kt{constructor(){a(this,_a,[]);if(t(Kt,Vs)!==null)throw new Error("LevelsDataProvider is a singleton class, use getInstance to get the instance");i(Kt,Vs,this)}static getInstance(){return t(Kt,Vs)===null&&i(Kt,Vs,new Kt),t(Kt,Vs)}initLevels(s){i(this,_a,s)}getById(s){const e=t(this,_a).find(n=>n.id==s);if(e===void 0)throw new Error("level is undefined");return e}};_a=new WeakMap,Vs=new WeakMap,a(Kt,Vs,null);let _r=Kt;const jr=class jr{};jr.data=[{id:1,title:"serpent",author:"ocliboy",comments:"first level and also used in unit testing",rowsMap:["111111111111111x","1000000000000000","1011111111111111","1010000000000001","1010000111111101","1011111100000101","1000000000000101","1111111111111101","0000000000000001","y111111111111111"],money:150,startDirection:E.LEFT,endDirection:E.LEFT},{id:9,title:"animal",author:"ocliboy",comments:"",rowsMap:["0000000000000000","0000000000000000","y11111100111111x","0000001001000000","0111111001111110","0100000000000010","0100111111110010","0100100000010010","0111100000011110","0000000000000000"],money:150,startDirection:E.LEFT,endDirection:E.LEFT},{id:13,title:"doble loop",author:"ocliboy",comments:"third level",rowsMap:["00000000x0000000","000000011000011y","0000001100001100","0000011000011000","0000110000110000","0000100000100000","0111111111111100","0100100000100100","0111100000111100","0000000000000000"],money:150,startDirection:E.DOWN,endDirection:E.RIGHT},{id:14,title:"one loop",author:"ocliboy",comments:"second valid level",rowsMap:["0000000000000000","001111100000011x","0010001111111100","0010000000000000","0010001111111100","0010001000000100","0011111111111100","0000001000000000","000000111111111y","0000000000000000"],money:150,startDirection:E.LEFT,endDirection:E.RIGHT},{id:15,title:"psycho",author:"ocliboy",comments:"",rowsMap:["000y000011100000","0011000110110000","0110001100011000","0100011000001000","0100010000111000","0100010000100000","0110110111111110","0010100100100010","0011100110111110","00000000x0000000"],money:150,startDirection:E.UP,endDirection:E.UP},{id:8,title:"cross",author:"ocliboy",comments:"",rowsMap:["000y000000000000","0001000000000000","0001022011111100","0001022010000100","0001000010220100","0001111110220100","0000000000000100","0000002201111100","0000002201000000","000000000x000000"],money:150,startDirection:E.UP,endDirection:E.UP},{id:10,title:"happy",author:"ocliboy",comments:"",rowsMap:["0000000000000000","011111111111111x","0100000000000000","0100022000022000","0100022000022000","0100000000000000","0102200000000220","0100020000002000","0100002222220000","0y00000000000000"],money:150,startDirection:E.LEFT,endDirection:E.DOWN},{id:11,title:"walls",author:"ocliboy",comments:"",rowsMap:["0000000000000000","0111101110222220","0122101010222220","0122101010000000","0122111010111110","0122000010100010","0122000010101110","0111100010101000","000010001110111y","0000x00000000000"],money:150,startDirection:E.UP,endDirection:E.RIGHT},{id:12,title:"question",author:"ocliboy",comments:"",rowsMap:["0000000000000000","x111111111111110","0000002222220010","0111020000002010","0101000022220010","0101000020000010","0101000000000010","0101000020000010","0101111111111110","0y00000000000000"],money:150,startDirection:E.RIGHT,endDirection:E.DOWN},{id:16,title:"threeloops",author:"ocliboy",comments:"",rowsMap:["0000000000000000","0111111000111000","0102201101101000","0111111111111200","0002221222122200","0002111112110000","0001121010011000","2211021110001122","2110022000000112","2y000000000000x2"],money:150,startDirection:E.UP,endDirection:E.DOWN},{id:22,title:"irreal",author:"ocliboy",comments:"problem: can reach the exit",rowsMap:["111111011101110x","0111111121112111","1111012101210101","1101110121012121","1111112101210101","0111110111011121","1112011101110111","1010201020102012","1112021101110111","y101111111112111"],money:150,startDirection:E.LEFT,endDirection:E.LEFT},{id:26,title:"castle",author:"ocliboy",comments:"problem: it has more rows than normal maps",rowsMap:["211y111111112222","2121222222211222","2111110201111102","2221012221012122","2111110201112102","2121222222222122","2121222222222122","2111112021112102","2121222222222122","2111112021112102","2221212021212122","2021112021111102","22222222222x2222"],money:150,startDirection:E.UP,endDirection:E.UP}];let kr=jr;var us;const Ne=class Ne extends $s{constructor(e,n,o,c={w:144,h:82},I={x:0,y:0}){super(e,c,n,I);a(this,us);i(this,us,o),t(this,us).position={x:e.x+Ne.MINIMAP_OFFSET_X,y:e.y+Ne.MINIMAP_OFFSET_Y}}drawOn(){super.drawOn(),t(this,us).draw()}drawOff(){super.drawOff(),t(this,us).draw()}drawHover(){super.drawHover(),t(this,us).draw()}get miniMap(){return t(this,us)}};us=new WeakMap,Ne.MINIMAP_OFFSET_X=14,Ne.MINIMAP_OFFSET_Y=-6;let Yr=Ne;var Zs,ka,Ya,Wr;const qt=class qt{constructor(s){a(this,Ya);a(this,ka);if(t(qt,Zs)!==null)throw new Error("ButtonsMiniMapsCreator is a singleton class, use getInstance to get the instance");i(this,ka,s),i(qt,Zs,this)}static getInstance(s){return t(qt,Zs)===null&&i(qt,Zs,new qt(s)),t(qt,Zs)}createOneRow(s,e,n){return h(this,Ya,Wr).call(this,s,e,n,!1)}createMultiRows(s,e,n){return h(this,Ya,Wr).call(this,s,e,n,!0)}};Zs=new WeakMap,ka=new WeakMap,Ya=new WeakSet,Wr=function(s,e,n,o){const p=n.x,V=[];let Wa=0,Va=0;for(const cc of s){const lc=t(this,ka).getById(cc);V.push(new Yr({x:n.x+Va*150,y:n.y+Wa*120},u.buttonMiniMapImages,new Gi(lc,e))),Va++,Va%5===0&&o&&(Wa++,n.x=p,Va=0)}return V},a(qt,Zs,null);let Xr=qt;var Bi,Hs;const jt=class jt{constructor(){a(this,Bi,[]);if(t(jt,Hs)!==null)throw new Error("NewsDataProvider is a singleton class, use getInstance to get the instance");i(jt,Hs,this)}static getInstance(){return t(jt,Hs)===null&&i(jt,Hs,new jt),t(jt,Hs)}initNewsItems(s){i(this,Bi,s)}getById(s){const e=t(this,Bi).find(n=>n.id==s);if(e===void 0)throw new Error("news item is undefined");return e}get last(){return t(this,Bi).reduce((s,e)=>e.id>s.id?e:s,{id:0,content:"",date:""})}};Bi=new WeakMap,Hs=new WeakMap,a(jt,Hs,null);let Vr=jt;const Jr=class Jr{};Jr.data=[{id:1,content:"new level with id 15 now available",date:"06-08-2024"},{id:2,content:"the main menu shows now the todays enemies",date:"09-08-2024"},{id:3,content:"gif tower defense has now a news section",date:"09-08-2024"}];let Zr=Jr,so,Se,Kr,qr,ee,Za,mr,Tr;window.addEventListener("load",()=>{const d=document.getElementById("defaultCanvas1");d&&d.remove()});window.preload=()=>{so=new uc(d=>{}),r.init(so),u.loadAll()};function Mc(){for(let d of document.getElementsByClassName("p5Canvas"))d.addEventListener("contextmenu",s=>{s.preventDefault(),window.mouseClicked()})}window.mouseClicked=()=>{switch(ee.state){case St.STATE_PLAY_SURVIVAL:Se.mouseClicked();break;case St.STATE_MENU_MAIN:Kr.mouseClicked();break;case St.STATE_MENU_SURVIVAL:qr.mouseClicked();break}};window.setup=()=>{r.p5.createCanvas(l.CANVAS_WIDTH,l.CANVAS_HEIGHT),Mc(),Tr=Vr.getInstance(),Tr.initNewsItems(Zr.data),Za=_r.getInstance(),Za.initLevels(kr.data),mr=Xr.getInstance(Za),ee=St.getInstance(St.STATE_MENU_MAIN),Se=Ur.getInstance(ee,Za),Kr=br.getInstance(ee,mr,Se,Tr),qr=Gr.getInstance(ee,mr,Se)};window.keyPressed=()=>{switch(ee.state){case St.STATE_PLAY_SURVIVAL:Se.keyPressed();break}};window.draw=()=>{switch(ee.state){case St.STATE_PLAY_SURVIVAL:Se.update(),Se.draw();break;case St.STATE_MENU_MAIN:Kr.draw();break;case St.STATE_MENU_SURVIVAL:qr.draw();break}};
